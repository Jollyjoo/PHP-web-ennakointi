<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<link href="img/favicon.ico" rel="shortcut icon" type="image/x-icon" />

<html data-wf-domain="hameen-osaamistarpeiden-ennakointi.webflow.io" data-wf-page="663b57623daa22b24eb919a5"
    data-wf-site="663b57613daa22b24eb91975" data-wf-status="1" lang="fi">

<head>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript">
        // Ladataan header.html (head) tiedostosta, kun sitä samaa käytetään niin monessa paikassa
        // muokkaile sitä jos haluat joka sivun yläosaan muutoksia
        function header() {
            fetch('./header.html')
                .then(response => response.text())
                .then(data => {
                    const head = document.head;
                    const headerContent = document.createElement('div');
                    headerContent.innerHTML = data;
                    head.appendChild(headerContent);
                })
                .catch(error => console.error('Error loading header.html:', error));
        }
        header();
    </script>
</head>

<body>


    <div data-collapse="medium" data-animation="default" data-duration="400" data-easing="ease" data-easing2="ease"
        role="banner" class="navigation-bar w-nav">
        <div class="w-container"> <a href="index.html" aria-current="page" class="brand-link w-nav-brand w--current">
                <img src="img/2logo-tulevaisuusluotain.png" width="170">
                <nav role="navigation" class="navigation-menu w-nav-menu"><a href="index.html" aria-current="page"
                        class="brand-link w-nav-brand w--current">
                        <img src="img/esr.jpg" width="350"><a></a>
                </nav>

                <div class="hamburger-button w-nav-button">
                    <img src="img/esr2.jpg" width="100">
                </div>
        </div>



        <div class="hero-section centered">
            <div data-w-id="e464d218-f801-55d1-1f50-7da00b5bfb8f" style="opacity:0" class="w-container">
                <h1 data-ix="fade-in-bottom-page-loads" class="hero-heading">TULEVAISUUSLUOTAIN</h1>

                <div data-ix="fade-in-bottom-page-loads" id="otsikot-placeholder">
                    <!--OTSIKOIDEN PLACEHOLDER - OTSIKOT.HTML -->
                </div>

            </div>
        </div>

        <div class="footer center"> <b>
                <a href="opiskelu.html" class="button"><b> KOULUTUS </b><br>
                    Tietoa koulutustasosta,<br> opiskelijamääristä ja <br> opiskelijoiden sijoittumisesta
                    <br>valmistumisen jälkeen.</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="tyollisyys.html" class="sivut-button"><b>TYÖLLISYYS</b> <br>Tietoa avoimista <br> työpaikoista
                    ja työttömistä <br> työnhakijoista.</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="vaesto.html" class="sivut-button"> <b>VÄESTÖ</b> <br>Tarkastele Hämeen <br>väestörakennetta ja
                    <br> väestön kehitystä</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="aluekehitys.html" class="sivut-button"><b>ELINVOIMA </b><br>Alueen ostovoimasta,<br>
                    toimialarakenteesta sekä <br>aloittaneista <br> ja lopettaneista yrityksistä.</a>
            </b>
            </b>
        </div>


        <div class="section">
            <div class="centerContainer">
                <div align="center" class="newsContainer">
                    <h3>Hämeen koulutusasteen avaintilastot</h3><br>

                    <span id="koulutus-summary">
                        Perusasteen jälkeisen tutkinnon suorittaneiden osuus 15 vuotta täyttäneestä väestöstä oli vuonna
                        <span id="koulutus-vuosi">...</span>
                        koko maassa <span id="koulutus-kokomaa"
                            style="font-weight:bold;text-decoration:underline;cursor:pointer;">...</span> %.
                        Kanta-Hämeessä vastaava
                        osuus oli <span id="koulutus-kantahame"
                            style="font-weight:bold;text-decoration:underline;cursor:pointer;">...</span> % ja
                        Päijät-Hämeessä <span id="koulutus-paijathame"
                            style="font-weight:bold;text-decoration:underline;cursor:pointer;">...</span> %.
                        Korkea-asteen suorittaneiden osuus tullee
                        Päijät-Hämeessä kasvamaan LUT-yliopiston opiskelijamäärien kasvaessa voimakkaasti Lahdessa.
                    </span><br>
                    <br>
                </div>

                <p><b> Vie hiiren osoitin lukujen päälle, niin näet kuvaajan </p></b>

                <div class="container">
                    <div class="tilastobox">
                        <p>Toisen asteen tutkinnon suorittaneet<br> (koko maa: <span id="toinen-sss">...</span> %)</p>
                        <h2><span id="toinen-mk07" style="text-decoration:underline;cursor:pointer;">...</span> %</h2>
                        <!-- Chart.js popup for Päijät-Häme toisen asteen tutkinnon suorittaneet -->
                        <div id="toinen-mk07-chart-popup"
                            style="display:none;position:absolute;z-index:1000;background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
                            <canvas id="toinen-mk07-chart" width="400" height="180"></canvas>
                            <div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">Toisen asteen
                                tutkinnon suorittaneet - historia</div>
                        </div>
                        <p> Päijät-Häme</p>
                        <h2><span id="toinen-mk05" style="text-decoration:underline;cursor:pointer;">...</span> %</h2>
                        <!-- Chart.js popup for Kanta-Häme toisen asteen tutkinnon suorittaneet -->
                        <div id="toinen-mk05-chart-popup"
                            style="display:none;position:absolute;z-index:1000;background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
                            <canvas id="toinen-mk05-chart" width="400" height="180"></canvas>
                            <div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">Toisen asteen
                                tutkinnon suorittaneet - historia</div>
                        </div>
                        <p>Kanta-Häme</p>

                        </p>
                    </div>
                    <div class="tilastobox">
                        <p>Korkea-asteen tutkinnon suorittaneet<br>(koko maa: <span id="korkea-sss">...</span> %)</p>
                        <h2><span id="korkea-mk07" style="text-decoration:underline;cursor:pointer;">...</span> %</h2>
                        <!-- Chart.js popup for Päijät-Häme korkea-asteen tutkinnon suorittaneet -->
                        <div id="korkea-mk07-chart-popup"
                            style="display:none;position:absolute;z-index:1000;background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
                            <canvas id="korkea-mk07-chart" width="400" height="180"></canvas>
                            <div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">Korkea-asteen
                                tutkinnon suorittaneet - historia</div>
                        </div>
                        <p>Päijät-Häme</p>
                        <h2><span id="korkea-mk05" style="text-decoration:underline;cursor:pointer;">...</span> %</h2>
                        <!-- Chart.js popup for Kanta-Häme korkea-asteen tutkinnon suorittaneet -->
                        <div id="korkea-mk05-chart-popup"
                            style="display:none;position:absolute;z-index:1000;background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
                            <canvas id="korkea-mk05-chart" width="400" height="180"></canvas>
                            <div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">Korkea-asteen
                                tutkinnon suorittaneet - historia</div>
                        </div>
                        <p>Kanta-Häme</p>
                        </p>
                    </div>
                </div>
                <p>Lähde: <a
                        href="https://pxdata.stat.fi/PXWeb/pxweb/fi/StatFin/StatFin__vkour/statfin_vkour_pxt_12bs.px"
                        target="_blank">Tilastokeskus 12bs</a>, viimeisin tilasto tarkistettu lähteestä <b><span
                            id="koulutus-paivitys">...</span></b>
                    <!--    <p></p>Lähde: Tilastokeskus 12bs -- 15 vuotta täyttänyt väestö koulutusasteen, maakunnan, kunnan, sukupuolen ja ikäryhmän mukaan
                <p id="koulutus-paivitys" style="text-align:center; font-size: 0.9em; color: #555;"></p> -->
            </div>
        </div>



        <div class="centerContainer" id="bookmark2">
            <h2><br> Valmistuneiden työllistyminen hämeessä: </h2><br><br>
            <iframe src='https://flo.uri.sh/visualisation/21612862/embed' title='Interactive or visual content'
                class='flourish-embed-iframe' frameborder='0' scrolling='no' style='width:45%;height:350px;'
                sandbox='allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation'></iframe>
            <iframe src='https://flo.uri.sh/visualisation/21613675/embed' title='Interactive or visual content'
                class='flourish-embed-iframe' frameborder='0' scrolling='no' style='width:45%;height:350px;'
                sandbox='allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation'></iframe>
        </div>

        <br><br>
        <div class="centerContainer" id="bookmark4">
            <h2> Tarkastele oppilaitoksista valmistuneiden sijoittumista: </h2><br><br>
            <!-- Buttons to select which visualization to show -->
            <div style="text-align: center; margin-bottom: 25px;">
                <button onclick="showVisualization('visual1')">Salpaus</button>
                <button onclick="showVisualization('visual2')">Kiipula</button>
                <button onclick="showVisualization('visual3')">Hyria</button>
                <button onclick="showVisualization('visual4')">HAMK</button>
                <button onclick="showVisualization('visual5')">LAB</button>
                <button onclick="showVisualization('visual6')">Tavastia</button>
                <button onclick="showVisualization('visual7')">LHKK</button>
            </div>

            <!-- Visualization 1 salpaus -->
            <div id="visual1" class="visualization" style="display: none;">
                <div class="flourish-embed" data-src="story/2982272">
                    <script src="https://public.flourish.studio/resources/embed.js"></script><noscript><img
                            src="https://public.flourish.studio/story/2982272/thumbnail" width="100%"
                            alt="visualization" /></noscript>
                </div>
            </div>

            <!-- Visualization 2 kiipula -->
            <div id="visual2" class="visualization" style="display: none;">
                <div class="flourish-embed" data-src="story/2998165">
                    <script src="https://public.flourish.studio/resources/embed.js"></script><noscript><img
                            src="https://public.flourish.studio/story/2998165/thumbnail" width="100%"
                            alt="visualization" /></noscript>
                </div>
            </div>

            <!-- Visualization 3 -->
            <div id="visual3" class="visualization" style="display: none;">
                <div class="flourish-embed" data-src="story/3006094">
                    <script src="https://public.flourish.studio/resources/embed.js"></script><noscript><img
                            src="https://public.flourish.studio/story/3006094/thumbnail" width="100%"
                            alt="visualization" /></noscript>
                </div>
            </div>

            <!-- hamk 4 -->
            <div id="visual4" class="visualization" style="display: none;">
                <div class="flourish-embed" data-src="story/3006281">
                    <script src="https://public.flourish.studio/resources/embed.js"></script><noscript><img
                            src="https://public.flourish.studio/story/3006281/thumbnail" width="100%"
                            alt="visualization" /></noscript>
                </div>
            </div>

            <!-- lab  5 -->
            <div id="visual5" class="visualization" style="display: none;">
                <div class="flourish-embed" data-src="story/3006283">
                    <script src="https://public.flourish.studio/resources/embed.js"></script><noscript><img
                            src="https://public.flourish.studio/story/3006283/thumbnail" width="100%"
                            alt="visualization" /></noscript>
                </div>
            </div>

            <!-- tavastia  6-->
            <div id="visual6" class="visualization" style="display: none;">
                <div class="flourish-embed" data-src="story/3006100">
                    <script src="https://public.flourish.studio/resources/embed.js"></script><noscript><img
                            src="https://public.flourish.studio/story/3006100/thumbnail" width="100%"
                            alt="visualization" /></noscript>
                </div>

            </div>
            <!-- lhkk 7 -->
            <div id="visual7" class="visualization" style="display: none;">
                <div class="flourish-embed" data-src="story/3006109">
                    <script src="https://public.flourish.studio/resources/embed.js"></script><noscript><img
                            src="https://public.flourish.studio/story/3006109/thumbnail" width="100%"
                            alt="visualization" /></noscript>
                </div>
            </div>

        </div>

        <script>
            // Popup chart logic for summary values (12 months)
            document.addEventListener('DOMContentLoaded', function () {
                function createPopup(id, chartId, label, endpoint, yLabel) {
                    const span = document.getElementById(id);
                    if (!span) return;
                    let popup = document.createElement('div');
                    popup.id = id + '-popup';
                    popup.style.display = 'none';
                    popup.style.position = 'fixed';
                    popup.style.zIndex = '1000';
                    popup.style.background = '#fff';
                    popup.style.border = '1px solid #ccc';
                    popup.style.padding = '10px';
                    popup.style.borderRadius = '8px';
                    popup.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
                    popup.innerHTML = `<canvas id="${chartId}" width="400" height="180"></canvas><div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">${label} - 20v</div>`;
                    document.body.appendChild(popup);
                    let chartInstance = null;
                    span.addEventListener('mouseover', function (e) {
                        popup.style.display = 'block';
                        let x = e.clientX + 40;
                        let y = e.clientY - 220;
                        if (x + 400 > window.innerWidth) x = window.innerWidth - 408;
                        if (x < 8) x = 8;
                        if (y < 8) y = 8;
                        popup.style.left = x + 'px';
                        popup.style.top = y + 'px';
                        if (!chartInstance) {
                            fetch(endpoint)
                                .then(resp => resp.json())
                                .then(hist => {
                                    // Use only last 20 years
                                    let labels = hist.labels;
                                    let data = hist.data;
                                    if (labels.length > 20) {
                                        labels = labels.slice(-20);
                                        data = data.slice(-20);
                                    }
                                    // Labels are years, no month parsing
                                    const minY = Math.floor(Math.min(...data) - 1);
                                    const maxY = Math.ceil(Math.max(...data) + 1);
                                    const ctx = document.getElementById(chartId).getContext('2d');
                                    chartInstance = new Chart(ctx, {
                                        type: 'line',
                                        data: {
                                            labels: labels,
                                            datasets: [{
                                                label: yLabel,
                                                data: data,
                                                borderColor: '#0077cc',
                                                backgroundColor: 'rgba(0,119,204,0.08)',
                                                fill: true,
                                                pointRadius: 3
                                            }]
                                        },
                                        options: {
                                            responsive: false,
                                            plugins: { legend: { display: false } },
                                            scales: {
                                                x: { title: { display: true, text: 'Vuosi' } },
                                                y: { title: { display: true, text: yLabel }, min: minY, max: maxY }
                                            }
                                        }
                                    });
                                });
                        }
                    });
                    span.addEventListener('mousemove', function (e) {
                        let x = e.clientX + 40;
                        let y = e.clientY - 220;
                        if (x + 400 > window.innerWidth) x = window.innerWidth - 408;
                        if (x < 8) x = 8;
                        if (y < 8) y = 8;
                        popup.style.left = x + 'px';
                        popup.style.top = y + 'px';
                    });
                    span.addEventListener('mouseout', function () {
                        popup.style.display = 'none';
                    });
                }
                // Koko maa
                createPopup('koulutus-kokomaa', 'koulutus-kokomaa-chart', 'Koko maa: Perusasteen jälkeisen tutkinnon suorittaneet (%)', 'opiskelu_historia.php?stat_code=SSS&field=perusjalk&limit=20', '%');
                // Kanta-Häme
                createPopup('koulutus-kantahame', 'koulutus-kantahame-chart', 'Kanta-Häme: Perusasteen jälkeisen tutkinnon suorittaneet (%)', 'opiskelu_historia.php?stat_code=MK05&field=perusjalk&limit=20', '%');
                // Päijät-Häme
                createPopup('koulutus-paijathame', 'koulutus-paijathame-chart', 'Päijät-Häme: Perusasteen jälkeisen tutkinnon suorittaneet (%)', 'opiskelu_historia.php?stat_code=MK07&field=perusjalk&limit=20', '%');
            });
            // Chart.js popup logic for education stats
            document.addEventListener('DOMContentLoaded', function () {
                // Helper for positioning
                function positionChartPopup(popup, e) {
                    const popupWidth = 400;
                    const popupHeight = 220;
                    let x = e.clientX + 20;
                    let y = e.clientY - popupHeight - 20;
                    if (x + popupWidth > window.innerWidth) x = window.innerWidth - popupWidth - 8;
                    if (x < 8) x = 8;
                    if (y + popupHeight > window.innerHeight) y = window.innerHeight - popupHeight - 8;
                    if (y < 8) y = 8;
                    popup.style.left = x + 'px';
                    popup.style.top = y + 'px';
                }
                // Chart configs
                const chartConfigs = [
                    {
                        spanId: 'toinen-mk07', popupId: 'toinen-mk07-chart-popup', canvasId: 'toinen-mk07-chart',
                        endpoint: 'opiskelu_historia.php?stat_code=MK07&field=toisenjalk', label: 'Toisen asteen tutkinnon suorittaneet', color: '#0077cc'
                    },
                    {
                        spanId: 'toinen-mk05', popupId: 'toinen-mk05-chart-popup', canvasId: 'toinen-mk05-chart',
                        endpoint: 'opiskelu_historia.php?stat_code=MK05&field=toisenjalk', label: 'Toisen asteen tutkinnon suorittaneet', color: '#cc3300'
                    },
                    {
                        spanId: 'korkea-mk07', popupId: 'korkea-mk07-chart-popup', canvasId: 'korkea-mk07-chart',
                        endpoint: 'opiskelu_historia.php?stat_code=MK07&field=korkeajalk', label: 'Korkea-asteen tutkinnon suorittaneet', color: '#0077cc'
                    },
                    {
                        spanId: 'korkea-mk05', popupId: 'korkea-mk05-chart-popup', canvasId: 'korkea-mk05-chart',
                        endpoint: 'opiskelu_historia.php?stat_code=MK05&field=korkeajalk', label: 'Korkea-asteen tutkinnon suorittaneet', color: '#cc3300'
                    }
                ];
                chartConfigs.forEach(cfg => {
                    const span = document.getElementById(cfg.spanId);
                    const popup = document.getElementById(cfg.popupId);
                    let chartInstance = null;
                    popup.style.position = 'fixed';
                    let chartDataLoaded = false;
                    let chartLabels = [];
                    let chartData = [];
                    span.addEventListener('mouseover', function (e) {
                        popup.style.display = 'block';
                        positionChartPopup(popup, e);
                        if (!chartDataLoaded) {
                            fetch(cfg.endpoint)
                                .then(resp => resp.json())
                                .then(hist => {
                                    chartLabels = hist.labels.map(l => l.replace(/M(\d{2})/, m => {
                                        const kk = parseInt(m.slice(1), 10);
                                        const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                                        return ' ' + (kuukausiNimet[kk - 1] || m);
                                    }));
                                    chartData = hist.data;
                                    chartDataLoaded = true;
                                    const minY = Math.floor(Math.min(...chartData) - 1);
                                    const maxY = Math.ceil(Math.max(...chartData) + 1);
                                    const ctx = document.getElementById(cfg.canvasId).getContext('2d');
                                    chartInstance = new Chart(ctx, {
                                        type: 'line',
                                        data: {
                                            labels: chartLabels,
                                            datasets: [{
                                                label: cfg.label,
                                                data: chartData,
                                                borderColor: cfg.color,
                                                backgroundColor: 'rgba(0,119,204,0.08)',
                                                fill: true,
                                                pointRadius: 3
                                            }]
                                        },
                                        options: {
                                            responsive: false,
                                            plugins: { legend: { display: false } },
                                            scales: {
                                                x: { title: { display: true, text: 'Kuukausi' } },
                                                y: { title: { display: true, text: '%' }, min: minY, max: maxY }
                                            }
                                        }
                                    });
                                });
                        }
                    });
                    span.addEventListener('mousemove', function (e) {
                        positionChartPopup(popup, e);
                    });
                    span.addEventListener('mouseout', function () {
                        popup.style.display = 'none';
                    });
                });
            });
            // Function to show the selected visualization and hide others
            function showVisualization(visualId) {
                // Hide all visualizations
                const visualizations = document.querySelectorAll('.visualization');
                visualizations.forEach(visual => {
                    visual.style.display = 'none';
                });

                // Show the selected visualization
                const selectedVisual = document.getElementById(visualId);
                if (selectedVisual) {
                    selectedVisual.style.display = 'block';
                }
            }

            // Show the first visualization by default
            showVisualization('visual1');
        </script>
        <br><br>



<!-- Vieraskieliset opiskelijat - embedded Chart.js line chart with stat_code and sektori selection -->
<div class="centerContainer" style="margin-bottom: 32px;">
    <h2>Vieraskielisten opiskelijoiden osuudet</h2>
    <div style="margin-bottom: 12px; text-align:center;">
        <label for="vieras-kunta-select">Valitse alue: </label>
        <select id="vieras-kunta-select"></select>
        <label for="vieras-sektori-select" style="margin-left:18px;">Sektori: </label>
        <select id="vieras-sektori-select"></select>
    </div>
    <div style="width: 100%; max-width: 900px; margin: 0 auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 18px 12px 8px 12px;">
        <canvas id="vieraskieliset-linechart-embed" width="900" height="480"></canvas>
        <div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">Vieraskieliset, ulkomaiset ja kaikki opiskelijat Hämeessä</div>
    </div>
    <script>
    // Vieraskieliset chart with stat_code and sektori selection
    let vierasChart = null;
    let vierasDataCache = {};
    function updateVierasChart(statCode, sektori) {
        const ctx = document.getElementById('vieraskieliset-linechart-embed').getContext('2d');
        if (vierasChart) { vierasChart.destroy(); }
        if (!vierasDataCache[statCode] || !vierasDataCache[statCode].data[sektori]) {
            // Show empty chart with 'Ei dataa'
            vierasChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false },
                        title: {
                            display: true,
                            text: 'Ei dataa valitulle alueelle/sektorille',
                            color: '#cc3300',
                            font: { size: 18 }
                        }
                    },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
            return;
        }
        const data = vierasDataCache[statCode].data[sektori];
        vierasChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.years,
                datasets: [
                    {
                        label: 'Yhteensä',
                        data: data.yhteensa,
                        borderColor: '#0077cc',
                        backgroundColor: 'rgba(0,119,204,0.08)',
                        fill: false,
                        pointRadius: 3,
                        tension: 0.15
                    },
                    {
                        label: 'Ulkomaiset',
                        data: data.ulkomaiset,
                        borderColor: '#cc3300',
                        backgroundColor: 'rgba(204,51,0,0.08)',
                        fill: false,
                        pointRadius: 3,
                        tension: 0.15
                    },
                    {
                        label: 'Vieraskieliset',
                        data: data.vieraskieliset,
                        borderColor: '#009933',
                        backgroundColor: 'rgba(0,153,51,0.08)',
                        fill: false,
                        pointRadius: 3,
                        tension: 0.15
                    }
                ]
            },
            options: {
                responsive: false,
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                // Show all values as usual
                                let label = context.dataset.label + ': ' + context.formattedValue;
                                // Add percentage for Ulkomaiset and Vieraskieliset
                                if (context.datasetIndex === 1 || context.datasetIndex === 2) {
                                    // Get yhteensa value for this index
                                    const yhteensa = context.chart.data.datasets[0].data[context.dataIndex];
                                    if (yhteensa && yhteensa > 0) {
                                        const val = context.parsed.y;
                                        const percent = ((val / yhteensa) * 100).toFixed(1);
                                        label += ' (' + percent + '%)';
                                    }
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: { title: { display: true, text: 'Vuosi' } },
                    y: { title: { display: true, text: 'Opiskelijoita' }, beginAtZero: true }
                }
            }
        });
    }
    // Store last selected sektori for each stat_code
    let vierasLastSektori = {};
    function fetchAndPopulateVieras(statCode) {
        fetch('vieraskieliset_historia.php?stat_code=' + encodeURIComponent(statCode))
            .then(resp => resp.json())
            .then(res => {
                vierasDataCache[statCode] = res;
                const sektoriSelect = document.getElementById('vieras-sektori-select');
                sektoriSelect.innerHTML = '';
                const sektorit = Object.keys(res.data);
                if (sektorit.length === 0) {
                    // No sektorit, clear chart and sektori select
                    updateVierasChart(statCode, '');
                    return;
                }
                let selectedSektori = vierasLastSektori[statCode] && sektorit.includes(vierasLastSektori[statCode]) ? vierasLastSektori[statCode] : sektorit[0];
                sektorit.forEach(sektori => {
                    const opt = document.createElement('option');
                    opt.value = sektori;
                    opt.textContent = sektori;
                    if (sektori === selectedSektori) opt.selected = true;
                    sektoriSelect.appendChild(opt);
                });
                if (selectedSektori) {
                    updateVierasChart(statCode, selectedSektori);
                }
            });
    }
    document.addEventListener('DOMContentLoaded', function() {
        // Populate stat_code select
        fetch('vieraskieliset_historia.php?list_stat_codes=1')
            .then(resp => resp.json())
            .then(res => {
                const kuntaSelect = document.getElementById('vieras-kunta-select');
                kuntaSelect.innerHTML = '';
                const grouped = res.stat_codes_grouped;
                let firstCode = null;
                // Maakuntataso optgroup first if exists
                if (grouped['maakunta']) {
                    const mkOptgroup = document.createElement('optgroup');
                    mkOptgroup.label = grouped['maakunta'].maakunta_nimi;
                    grouped['maakunta'].kunnat.forEach(item => {
                        const opt = document.createElement('option');
                        opt.value = item.stat_code;
                        opt.textContent = item.kunta + ' (' + item.stat_code + ')';
                        mkOptgroup.appendChild(opt);
                        if (!firstCode) firstCode = item.stat_code;
                    });
                    kuntaSelect.appendChild(mkOptgroup);
                }
                for (const mkid in grouped) {
                    if (mkid === 'maakunta') continue;
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = grouped[mkid].maakunta_nimi + ' (' + mkid + ')';
                    grouped[mkid].kunnat.forEach(item => {
                        const opt = document.createElement('option');
                        opt.value = item.stat_code;
                        opt.textContent = item.kunta + ' (' + item.stat_code + ')';
                        optgroup.appendChild(opt);
                        if (!firstCode) firstCode = item.stat_code;
                    });
                    kuntaSelect.appendChild(optgroup);
                }
                kuntaSelect.addEventListener('change', function() {
                    fetchAndPopulateVieras(this.value);
                });
                if (firstCode) fetchAndPopulateVieras(firstCode);
            });
        document.getElementById('vieras-sektori-select').addEventListener('change', function() {
            const statCode = document.getElementById('vieras-kunta-select').value;
            vierasLastSektori[statCode] = this.value;
            updateVierasChart(statCode, this.value);
        });
    });
    </script>
                    <p>Lähde: <a
                        href="https://pxdata.stat.fi/PxWeb/pxweb/fi/StatFin/StatFin__opiskt/statfin_opiskt_pxt_11c4.px/"
                        target="_blank"
                        title="11c4 -- Tutkintotavoitteisen koulutuksen vieraskieliset ja ulkomaalaiset opiskelijat koulutusalueen ja koulutussektorin mukaan, 2004-2023">
                        Tilastokeskus: 11c4</a>, viimeisin tilasto tarkistettu lähteestä <b>
                        <span id="stat-paivitys-X">...</span></b>
                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            fetch('vieraskieliset_historia.php?get_last_update=1')
                                .then(resp => resp.json())
                                .then(res => {
                                    if (res && res.last_update) {
                                        document.getElementById('stat-paivitys-X').textContent = res.last_update;
                                    }
                                });
                        });
                        </script>
    </p>
</div>


        <!--opiskelu-->

        <br>
        <p align="center">
        <h2>Vieraskieliset opiskelijat Hämeessä.</h2><br>
        </p>
        <div class="centerContainer">
            Vieraskielisten opiskelijoiden määrä on kasvanut tasaisesti vuodesta 2010 lähtien. <br>
            Vuonna 2023 vieraskielisiä opiskelijoita oli Hämeessä yhteensä 4 500.
            Vieraskielisten osuus kaikista opiskelijoista on noin 10 %. <br><br>
            <iframe title="Vieraskieliset_opiskelijat_stat" width="100%" height="650"
                src="https://app.powerbi.com/view?r=eyJrIjoiMzFhOTkwZjUtNWQzYy00YWYwLTgyMzEtZDMxYWQ1ZTZjZGEzIiwidCI6ImM3YjJjZGYxLTcxN2YtNGY3Mi04NGUwLWY2Nzg0Nzk5YTgzNiIsImMiOjh9"
                frameborder="0" allowFullScreen="true"></iframe>
            <p>
                Lähde: Tilastokeskus: 11c4 -- Tutkintotavoitteisen koulutuksen vieraskieliset ja ulkomaalaiset
                opiskelijat koulutusalueen <br> ja koulutussektorin mukaan, 2004-2023
            </p>
        </div><br><br>

        <br>
        <p align="center">
        <h2 id="bookmark5"> Hämeen 2. asteen ammattioppilaitosten opiskelijamäärät opintolinjoittain.</h2>
        </p>
        <div class="centerContainer">
            <iframe title="Vipunen_API online" width="100%" height="650"
                src="https://app.powerbi.com/view?r=eyJrIjoiNGJlNTRkODgtYWMyZi00ZDc3LTlmM2ItOTI1MGM0MzZiZWMyIiwidCI6ImM3YjJjZGYxLTcxN2YtNGY3Mi04NGUwLWY2Nzg0Nzk5YTgzNiIsImMiOjh9"
                frameborder="0" allowFullScreen="true"></iframe>
        </div><br>

    </div>
    <!-- Footer ja lisätiedot -->
    <div class="footer">
        <div class="w-container">
            <div class="w-row">
                <div class="spc w-col w-col-4">
                    <h5>Sivuston osiot</h5>
                    <a href="opiskelu.html" class="footer-link">Tilannekuva</a>
                    <a href="ennakointi.html" class="footer-link">Tulevaisuuskuva</a>
                    <a href="info.html" class="footer-link">Tietoa meistä</a>
                    <a href="mailto:info@tulevaisuusluotain.fi;christian@tulevaisuusluotain.fi?subject=Palautetta tulevaisuusluotain-sivuston kautta"" class="
                        footer-link"><b>ANNA PALAUTETTA TAI KEHITYSEHDOTUKSIA</b></a>
                    <a href="mediaseuranta.html" class="footer-link" target="_blank"><b>HÄMEEN ELY-MEDIASEURANTA</b></a>
                    <a href="Saavutettavuusseloste.html" class="footer-link"
                        target="_blank"><b>SAAVUTETTAVUUSSELOSTE</b></a>
                </div>
                <div class="spc w-col w-col-4">
                    <h5>Tilannekuva - osio</h5>
                    <a href="opiskelu.html" class="footer-link">Koulutus</a>
                    <a href="tyollisyys.html" class="footer-link">Työllisyys</a>
                    <a href="vaesto.html" class="footer-link">Väestö</a>
                    <a href="aluekehitys.html" class="footer-link">Elinvoima</a>

                </div>

                <div class=" w-col w-col-4">
                    <h5>Hyödyllisiä linkkejä</h5>
                    <a href="https://www.osaamistarvekompassi.fi" class="footer-link" target="_blank">JOTPA -
                        Osaamistarvekompassi</a>
                    <a href="https://www.oph.fi/fi/palvelut/osaamisen-ennakointifoorumi-oef" target="_blank"
                        class="footer-link">OEF - Osaamisen ennakointifoorumi</a>
                    <a href="https://tyomarkkinatori.fi/teemasivut/tyovoiman-saatavuus-ja-kohtaanto" target="_blank"
                        class="footer-link">Työvoiman saatavuus ja kohtaanto</a>
                    <a href="https://vipunen.fi/fi-fi/ennakointi" class="footer-link" target="_blank">Vipunen /
                        Ennakointi</a>
                    <a href="https://app.powerbi.com/view?r=eyJrIjoiODFkNGVlMDAtMzMxZi00MWI0LWE3YTEtMzM0ZGQzMzliOGNjIiwidCI6ImI0MjZhNDVlLTBiMjYtNGE0MC05MWUxLTVhYjdlODc4OThlYyIsImMiOjh9"
                        class="footer-link" target="_blank"">
                        Hämeen elinvoimakatsaus</a>
                </div>
            </div>
        </div>
    </div>


        <div class=" footer center">

                </div>
                <script
                    src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=663b57613daa22b24eb91975"
                    type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
                    crossorigin="anonymous"></script>
                <script src="webflow.js" type="text/javascript"></script>
                <script type="text/javascript">
                    // Ladataan tuo otsikot.html tiedostosta, kun sitä samaa käytetään niin monessa paikassa
                    function otsikot() {
                        fetch('./otsikot.html')
                            .then(response => response.text())
                            .then(data => {
                                const placeholder = document.getElementById('otsikot-placeholder');
                                placeholder.innerHTML = data;
                            })
                            .catch(error => console.error('Error loading otsikot.html:', error));
                    }
                    otsikot();
                </script>
                <script>
                    // Fetch education stats dynamically
                    fetch('opiskelu.php')
                        .then(response => response.json())
                        .then(data => {
                            if (data.maakunnat) {
                                // Päijät-Häme = MK07, Kanta-Häme = MK05, Koko maa = SSS
                                document.getElementById('toinen-mk07').textContent = data.maakunnat.MK07?.toisenjalk ?? '-';
                                document.getElementById('toinen-mk05').textContent = data.maakunnat.MK05?.toisenjalk ?? '-';
                                document.getElementById('korkea-mk07').textContent = data.maakunnat.MK07?.korkeajalk ?? '-';
                                document.getElementById('korkea-mk05').textContent = data.maakunnat.MK05?.korkeajalk ?? '-';
                                document.getElementById('toinen-sss').textContent = data.maakunnat.SSS?.toisenjalk ?? '-';
                                document.getElementById('korkea-sss').textContent = data.maakunnat.SSS?.korkeajalk ?? '-';
                                // Update summary sentence values
                                document.getElementById('koulutus-vuosi').textContent = data.aika ?? '';
                                document.getElementById('koulutus-kokomaa').textContent = data.maakunnat.SSS?.perusjalk ?? '-';
                                document.getElementById('koulutus-kantahame').textContent = data.maakunnat.MK05?.perusjalk ?? '-';
                                document.getElementById('koulutus-paijathame').textContent = data.maakunnat.MK07?.perusjalk ?? '-';
                            }
                            if (data.paivitys) {
                                document.getElementById('koulutus-paivitys').textContent = data.paivitys;
                            }
                        })
                        .catch(err => {
                            document.getElementById('toinen-mk07').textContent = '-';
                            document.getElementById('toinen-mk05').textContent = '-';
                            document.getElementById('korkea-mk07').textContent = '-';
                            document.getElementById('korkea-mk05').textContent = '-';
                            document.getElementById('toinen-sss').textContent = '-';
                            document.getElementById('korkea-sss').textContent = '-';
                            document.getElementById('koulutus-paivitys').textContent = 'Tilastojen haku epäonnistui.';
                            document.getElementById('koulutus-vuosi').textContent = '-';
                            document.getElementById('koulutus-kokomaa').textContent = '-';
                            document.getElementById('koulutus-kantahame').textContent = '-';
                            document.getElementById('koulutus-paijathame').textContent = '-';

                        });
                </script>
</body>

</html>