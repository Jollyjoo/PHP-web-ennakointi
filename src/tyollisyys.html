<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<link href="img/favicon.ico" rel="shortcut icon" type="image/x-icon" />

<!-- This site was created in Webflow. https://www.webflow.com --><!-- Last Published: Fri May 10 2024 06:29:03 GMT+0000 (Coordinated Universal Time) -->
<html data-wf-domain="hameen-osaamistarpeiden-ennakointi.webflow.io" data-wf-page="663b57623daa22b24eb919a5"
    data-wf-site="663b57613daa22b24eb91975" data-wf-status="1" lang="fi">

<head>
    <script type="text/javascript">
        // Ladataan tuo header.html (head) tiedostosta, kun sitä samaa käytetään niin monessa paikassa
        // muokkaile sitä jos haluat joka sivun yläosaan muutoksia
        function header() {
            fetch('./header.html')
                .then(response => response.text())
                .then(data => {
                    const head = document.head;
                    const headerContent = document.createElement('div');
                    headerContent.innerHTML = data;
                    head.appendChild(headerContent);
                })
                .catch(error => console.error('Error loading header.html:', error));
        }
        header();
    </script>
</head>

<body>
    <div data-collapse="medium" data-animation="default" data-duration="400" data-easing="ease" data-easing2="ease"
        role="banner" class="navigation-bar w-nav">
        <div class="w-container"> <a href="index.html" aria-current="page" class="brand-link w-nav-brand w--current">
                <img src="img/2logo-tulevaisuusluotain.png" width="170">
                <nav role="navigation" class="navigation-menu w-nav-menu"><a href="index.html" aria-current="page"
                        class="brand-link w-nav-brand w--current">
                        <img src="img/esr.jpg" width="350"><a></a>
                </nav>

                <div class="hamburger-button w-nav-button">
                    <img src="img/esr2.jpg" width="100">
                </div>
        </div>

        <div class="hero-section centered">
            <div data-w-id="e464d218-f801-55d1-1f50-7da00b5bfb8f" style="opacity:0" class="w-container">
                <h1 data-ix="fade-in-bottom-page-loads" class="hero-heading">TULEVAISUUSLUOTAIN</h1>


                <div data-ix="fade-in-bottom-page-loads" id="otsikot-placeholder">
                    <!--OTSIKOIDEN PLACEHOLDER - OTSIKOT.HTML -->
                </div>
            </div>
        </div>
        <div class="footer center"> <b>
                <a href="opiskelu.html" class="sivut-button"><b> KOULUTUS </b><br>
                    Tietoa koulutustasosta,<br> opiskelijamääristä ja <br> opiskelijoiden sijoittumisesta
                    <br>valmistumisen jälkeen.</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="tyollisyys.html" class="button"><b>TYÖLLISYYS</b> <br>Tietoa avoimista <br> työpaikoista ja

                    työttömistä <br> työnhakijoista.</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="vaesto.html" class="sivut-button"> <b>VÄESTÖ</b> <br>Tarkastele Hämeen <br>väestörakennetta ja
                    <br> väestön kehitystä</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="aluekehitys.html" class="sivut-button"><b>ELINVOIMA </b><br>Alueen ostovoimasta,<br>
                    toimialarakenteesta sekä <br>aloittaneista <br> ja lopettaneista yrityksistä.</a>

            </b>
        </div>

        <div class="section">
            <div class="centerContainer">
                <div align="center" class="newsContainer">
                    <h3>Hämeen työllisyyden avaintilastot</h3><br>
                    <span id="tyollisyys-summary">...</span>
                </div><br>
                <p><b> Vie hiiren osoitin lukujen päälle, niin näet kuvaajan </p></b>

                <div class="container">
                    <div class="tilastobox">
                        <p>Työttömien osuus työvoimasta <span id="stat-aika"></span></p>
                        <table>
                            <tr>
                                <td style="width:70%">

                                    <h2 style="position:relative;"><span id="ph-osuus"
                                            style="cursor:pointer;text-decoration:underline;">...</span> %
                                        <!-- Chart.js popup for history -->
                                        <div id="ph-osuus-chart-popup"
                                            style="display:none;position:absolute;z-index:1000;background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
                                            <canvas id="ph-osuus-chart" width="400" height="180"></canvas>
                                            <div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">
                                                Työttömien
                                                osuus työvoimasta - historia</div>
                                        </div>
                                </td>
                                <td style="width:30%">
                                    <canvas id="tyollisyys-embed-chart" width="210" height="40"
                                        style="vertical-align:middle;cursor:pointer;margin-left:12px;"></canvas>
                                </td> <p>Päijät-Häme</p>
                            </tr>

                            </h2>
                           
                            <tr>
                                <td style="width:70%">
                                    <h2><span id="kh-osuus" style="cursor:pointer;text-decoration:underline;">...</span>
                                        %
                                        <!-- Chart.js popup for Kanta-Häme history -->
                                        <div id="kh-osuus-chart-popup"
                                            style="display:none;position:absolute;z-index:1000;background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
                                            <canvas id="kh-osuus-chart" width="400" height="180"></canvas>
                                            <div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">
                                                Työttömien osuus työvoimasta - historia</div>
                                        </div>
                                         </td>
                                <td style="width:30%">
                                        <canvas id="kh-embed-chart" width="210" height="40"
                                            style="vertical-align:middle;cursor:pointer;margin-left:12px;"></canvas>
                                    </h2>
                                </td>
                            </tr>
                        </table>
                        <p>Kanta-Häme</p>

                        </p>
                    </div>
                    <div class="tilastobox">
                        <p>Uudet avoimet työpaikat <span id="stat-aika2"></span></p>
                        <h2><span id="ph-avoimet" style="cursor:pointer;text-decoration:underline;">...</span></h2>
                        <!-- Chart.js popup for Päijät-Häme avoimet työpaikat -->
                        <div id="ph-avoimet-chart-popup"
                            style="display:none;position:absolute;z-index:1000;background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
                            <canvas id="ph-avoimet-chart" width="400" height="180"></canvas>
                            <div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">Uudet avoimet
                                työpaikat - historia</div>
                        </div>
                        <p>Päijät-Häme</p>
                        <h2><span id="kh-avoimet" style="cursor:pointer;text-decoration:underline;">...</span></h2>
                        <!-- Chart.js popup for Kanta-Häme avoimet työpaikat -->
                        <div id="kh-avoimet-chart-popup"
                            style="display:none;position:absolute;z-index:1000;background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
                            <canvas id="kh-avoimet-chart" width="400" height="180"></canvas>
                            <div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">Uudet avoimet
                                työpaikat - historia</div>
                        </div>
                        <p>Kanta-Häme</p>

                        </p>
                    </div>
                    <div class="tilastobox">
                        <p>Työttömät työnhakijat <span id="stat-aika3"></span></p>
                        <h2><span id="ph-tyottomat" style="cursor:pointer;text-decoration:underline;">...</span></h2>
                        <!-- Chart.js popup for Päijät-Häme työttömät työnhakijat -->
                        <div id="ph-tyottomat-chart-popup"
                            style="display:none;position:absolute;z-index:1000;background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
                            <canvas id="ph-tyottomat-chart" width="400" height="180"></canvas>
                            <div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">Työttömät
                                työnhakijat - historia</div>
                        </div>
                        <p>Päijät-Häme</p>
                        <h2><span id="kh-tyottomat" style="cursor:pointer;text-decoration:underline;">...</span></h2>
                        <!-- Chart.js popup for Kanta-Häme työttömät työnhakijat -->
                        <div id="kh-tyottomat-chart-popup"
                            style="display:none;position:absolute;z-index:1000;background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
                            <canvas id="kh-tyottomat-chart" width="400" height="180"></canvas>
                            <div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">Työttömät
                                työnhakijat - historia</div>
                        </div>
                        <p>Kanta-Häme</p>
                        </p>
                    </div>
                </div>
                <p>Lähde: <a
                        href="https://pxdata.stat.fi/PXWeb/pxweb/fi/StatFin/StatFin__tyonv/statfin_tyonv_pxt_12r5.px"
                        target="_blank"
                        title="12r5 -- Työttömät työnhakijat eri ryhmissä, palveluissa olevat ja avoimet työpaikat kuukauden lopussa">
                        Tilastokeskus 12r5</a> (työnvälitystilasto, KEHA), viimeisin tilasto tarkistettu lähteestä <b>
                        <span id="stat-paivitys-2">...</span></b>
            </div>
        </div>


        <!-- swiper ************* -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
        <script type="module">
            import Swiper from 'https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.mjs'

            const swiper = new Swiper('.swiper', {
                // Optional parameters
                direction: 'horizontal',
                loop: true,

                pagination: { el: ".swiper-pagination", enabled: false },

                // Navigation arrows
                navigation: {
                    enabled: true,
                    prevEl: ".swiper-button-prev",
                    nextEl: ".swiper-button-next",
                },


                // And if we need scrollbar
                scrollbar: {
                    el: '.swiper-scrollbar',
                },
                keyboard: { enabled: true },
                mousewheel: { enabled: true },
                slidesPerView: 1,
                centeredSlides: true,
                coverflow: true,
                effect: 'coverflow',
                grabCursor: true,
                centeredSlides: true,
                watchSlidesProgress: true,
                observer: true,
                speed: 600,

            });
        </script>



        <div id="bookmark3" class="embedded-charts-flex">
            <div
                style="flex:1 1 0;min-width:340px;max-width:600px;background:#eaf6fb;padding:20px;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.10);">
                <h3 style="text-align:center;">Avoimet työpaikat (viimeiset 4 vuotta)</h3>
                <canvas id="avoimet-embedded-chart" width="560" height="260"></canvas>
            </div>
            <div
                style="flex:1 1 0;min-width:340px;max-width:600px;background:#eaf6fb;padding:20px;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.10);">
                <h3 style="text-align:center;">Työttömät työnhakijat (viimeiset 4 vuotta)</h3>
                <canvas id="tyottomat-embedded-chart" width="560" height="260"></canvas>
            </div>
        </div>
        <p align="center">Lähde: <a
                href="https://pxdata.stat.fi/PXWeb/pxweb/fi/StatFin/StatFin__tyonv/statfin_tyonv_pxt_12r5.px"
                target="_blank"
                title="12r5 -- Työttömät työnhakijat eri ryhmissä, palveluissa olevat ja avoimet työpaikat kuukauden lopussa">
                Tilastokeskus 12r5</a> (työnvälitystilasto, KEHA), viimeisin tilasto tarkistettu lähteestä <b> <span
                    id="stat-paivitys">...</span></b></p>


        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Fetch data for both regions
                // Fetch data for both charts in parallel
                Promise.all([
                    // Avoimet työpaikat
                    fetch('tyollisyys_historia.php?stat_code=MK07&field=uudetavp&limit=48').then(r => r.json()),
                    fetch('tyollisyys_historia.php?stat_code=MK05&field=uudetavp&limit=48').then(r => r.json()),
                    // Työttömät työnhakijat
                    fetch('tyollisyys_historia.php?stat_code=MK07&field=tyottomatlopussa&limit=48').then(r => r.json()),
                    fetch('tyollisyys_historia.php?stat_code=MK05&field=tyottomatlopussa&limit=48').then(r => r.json())
                ]).then(([phAvoimet, khAvoimet, phTyottomat, khTyottomat]) => {
                    function lastN(arr, n) { return arr.slice(-n); }
                    const N = 48;
                    // Helper to show error message in chart area
                    function showChartError(canvasId, msg) {
                        const canvas = document.getElementById(canvasId);
                        if (canvas) {
                            const parent = canvas.parentElement;
                            parent.innerHTML = `<div style='color:#cc3300;text-align:center;font-size:20px;padding:40px 0;'>${msg}</div>`;
                        }
                    }
                    // Check for errors or missing data
                    if (phAvoimet.error || khAvoimet.error || !phAvoimet.labels || !khAvoimet.labels) {
                        showChartError('avoimet-embedded-chart', 'Ei tietokantayhteyttä');
                    } else {
                        // Avoimet työpaikat chart
                        const labelsAvoimet = lastN(phAvoimet.labels, N).map(l => l.replace(/M(\d{2})/, m => {
                            const kk = parseInt(m.slice(1), 10);
                            const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                            return ' ' + (kuukausiNimet[kk - 1] || m);
                        }));
                        const phAvoimetData = lastN(phAvoimet.data, N);
                        const khAvoimetData = lastN(khAvoimet.data, N);
                        const minY1 = Math.floor(Math.min(...phAvoimetData.concat(khAvoimetData)) - 1);
                        const maxY1 = Math.ceil(Math.max(...phAvoimetData.concat(khAvoimetData)) + 1);
                        const ctx1 = document.getElementById('avoimet-embedded-chart').getContext('2d');
                        new Chart(ctx1, {
                            type: 'line',
                            data: {
                                labels: labelsAvoimet,
                                datasets: [
                                    {
                                        label: 'Päijät-Häme',
                                        data: phAvoimetData,
                                        borderColor: '#009933',
                                        backgroundColor: 'rgba(0,153,51,0.08)',
                                        fill: true,
                                        pointRadius: 2
                                    },
                                    {
                                        label: 'Kanta-Häme',
                                        data: khAvoimetData,
                                        borderColor: '#3366cc',
                                        backgroundColor: 'rgba(51,102,204,0.08)',
                                        fill: true,
                                        pointRadius: 2
                                    }
                                ]
                            },
                            options: {
                                responsive: false,
                                plugins: {
                                    legend: { display: true, position: 'top' },
                                    tooltip: {
                                        mode: 'index',
                                        intersect: false
                                    }
                                },
                                scales: {
                                    x: { title: { display: true, text: 'Kuukausi' } },
                                    y: { title: { display: true, text: 'Lkm' }, min: minY1, max: maxY1 }
                                },
                                layout: { padding: 10 },
                                backgroundColor: '#eaf6fb'
                            }
                        });
                    }
                    if (phTyottomat.error || khTyottomat.error || !phTyottomat.labels || !khTyottomat.labels) {
                        showChartError('tyottomat-embedded-chart', 'Ei tietokantayhteyttä');
                    } else {
                        // Työttömät työnhakijat chart
                        const labelsTyottomat = lastN(phTyottomat.labels, N).map(l => l.replace(/M(\d{2})/, m => {
                            const kk = parseInt(m.slice(1), 10);
                            const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                            return ' ' + (kuukausiNimet[kk - 1] || m);
                        }));
                        const phTyottomatData = lastN(phTyottomat.data, N);
                        const khTyottomatData = lastN(khTyottomat.data, N);
                        const minY2 = Math.floor(Math.min(...phTyottomatData.concat(khTyottomatData)) - 1);
                        const maxY2 = Math.ceil(Math.max(...phTyottomatData.concat(khTyottomatData)) + 1);
                        const ctx2 = document.getElementById('tyottomat-embedded-chart').getContext('2d');
                        new Chart(ctx2, {
                            type: 'line',
                            data: {
                                labels: labelsTyottomat,
                                datasets: [
                                    {
                                        label: 'Päijät-Häme',
                                        data: phTyottomatData,
                                        borderColor: '#cc3300',
                                        backgroundColor: 'rgba(204,51,0,0.08)',
                                        fill: true,
                                        pointRadius: 2
                                    },
                                    {
                                        label: 'Kanta-Häme',
                                        data: khTyottomatData,
                                        borderColor: '#3366cc',
                                        backgroundColor: 'rgba(51,102,204,0.08)',
                                        fill: true,
                                        pointRadius: 2
                                    }
                                ]
                            },
                            options: {
                                responsive: false,
                                plugins: {
                                    legend: { display: true, position: 'top' },
                                    tooltip: {
                                        mode: 'index',
                                        intersect: false
                                    }
                                },
                                scales: {
                                    x: { title: { display: true, text: 'Kuukausi' } },
                                    y: { title: { display: true, text: 'Lkm' }, min: minY2, max: maxY2 }
                                },
                                layout: { padding: 10 },
                                backgroundColor: '#eaf6fb'
                            }
                        });
                    }
                }).catch(() => {
                    // General error fallback
                    const ids = ['avoimet-embedded-chart', 'tyottomat-embedded-chart'];
                    ids.forEach(id => {
                        const canvas = document.getElementById(id);
                        if (canvas) {
                            const parent = canvas.parentElement;
                            parent.innerHTML = `<div style='color:#cc3300;text-align:center;font-size:20px;padding:40px 0;'>Ei tietokantayhteyttä</div>`;
                        }
                    });
                });
            });
        </script>


        <div class="centerContainer">
            <!-- <iframe src='https://flo.uri.sh/visualisation/21335132/embed' title='Interactive or visual content'
                class='flourish-embed-iframe' frameborder='0' scrolling='no' style='width:40%;height:400px;'
                sandbox='allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation'></iframe>
            
            
                <iframe src='https://flo.uri.sh/visualisation/21459814/embed' title='Interactive or visual content'
                class='flourish-embed-iframe' frameborder='0' scrolling='no' style='width:40%;height:400px;'
                sandbox='allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation'></iframe>
 -->



            <!-- Avoimet työpaikat toimialoittain Chart.js embedded chart -->
            <br><br>
            <div
                style="max-width:1240px;margin:0 auto 40px auto;background:#f7fbfc;padding:20px;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.10);">
                <h3 style="text-align:center;">Avoimet työpaikat toimialoittain (viimeiset 24kk)</h3>
                <div style="text-align:center;margin-bottom:12px;">
                    <label for="avoimet-statcode-select"><b>Valitse alue sekä kaaviotyyppi</b></label>
                    <select id="avoimet-statcode-select" style="font-size:16px;padding:4px 12px;border-radius:6px;">
                        <option value="SSS" selected>Koko maa (SSS)</option>
                        <option value="MK05">Kanta-Häme (MK05)</option>
                        <option value="MK07">Päijät-Häme (MK07)</option>
                    </select>
                    <div style="display:inline-block;margin-left:24px;">
                        <button id="chart-type-bar" type="button"
                            style="font-size:15px;padding:4px 16px;border-radius:6px;margin-right:8px;background:#eaf6fb;border:1px solid #cc3300;cursor:pointer;">Pinottu
                            pylväs</button>
                        <button id="chart-type-line" type="button"
                            style="font-size:15px;padding:4px 16px;border-radius:6px;background:#eaf6fb;border:1px solid #0077cc;cursor:pointer;">Viivakaavio</button>
                        <button id="toggle-datasets" type="button"
                            style="font-size:15px;padding:4px 16px;border-radius:6px;margin-left:8px;background:#f7fbfc;border:1px solid #666;cursor:pointer;">Piilota
                            kaikki toimialat</button>
                    </div>
                </div>
                <canvas id="avoimet-toimiala-chart" width="1100" height="600"></canvas>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    const select = document.getElementById('avoimet-statcode-select');
                    const canvas = document.getElementById('avoimet-toimiala-chart');
                    const btnLine = document.getElementById('chart-type-line');
                    const btnBar = document.getElementById('chart-type-bar');
                    let chartInstance = null;
                    let currentType = 'bar';
                    const btnToggleDatasets = document.getElementById('toggle-datasets');
                    let allHidden = false;
                    function fetchAndDraw(statCode, chartType = 'line') {
                        allHidden = false;
                        if (btnToggleDatasets) btnToggleDatasets.textContent = 'Piilota kaikki toimialat';
                        fetch(`avoimetpainat_historia.php?stat_code=${statCode}&limit=24`)
                            .then(resp => resp.json())
                            .then(response => {
                                const raw = response.data || [];
                                const latestUpdate = response.latest_update || '...';
                                document.getElementById('avoimet-toimiala-update').textContent = latestUpdate;
                                const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                                const months = [...new Set(raw.map(r => r.Tilastokuukausi))].sort();
                                const toimialas = [...new Set(raw.map(r => r.Toimiala))];
                                const colors = ['#0077cc', '#cc3300', '#009933', '#3366cc', '#cc9900', '#9900cc', '#00cc99', '#ff6600', '#666666'];
                                let colorIdx = 0;
                                const datasets = toimialas.map(toimiala => {
                                    const label = toimiala;
                                    const data = months.map(month => {
                                        const found = raw.find(r => r.Tilastokuukausi === month && r.Toimiala === toimiala);
                                        return found ? parseInt(found.Maara, 10) : 0;
                                    });
                                    const ds = {
                                        label,
                                        data,
                                        borderColor: colors[colorIdx % colors.length],
                                        backgroundColor: colors[colorIdx % colors.length] + (chartType === 'bar' ? 'cc' : '22'),
                                        fill: chartType === 'line' ? false : true,
                                        pointRadius: 2,
                                        tension: chartType === 'line' ? 0.45 : undefined
                                    };
                                    colorIdx++;
                                    return ds;
                                });
                                const labels = months.map(l => {
                                    const m = l.match(/M(\d{2})/);
                                    if (m) {
                                        const kk = parseInt(m[1], 10);
                                        return kuukausiNimet[kk - 1] + ' ' + l.slice(0, 4);
                                    }
                                    return l;
                                });
                                if (chartInstance) {
                                    chartInstance.destroy();
                                }
                                chartInstance = new Chart(canvas.getContext('2d'), {
                                    type: chartType,
                                    data: { labels, datasets },
                                    options: {
                                        responsive: false,
                                        plugins: {
                                            legend: { display: true, position: 'top' },
                                            tooltip: { mode: 'nearest', intersect: true }
                                        },
                                        scales: {
                                            x: { title: { display: true, text: 'Kuukausi' }, stacked: chartType === 'bar' },
                                            y: { title: { display: true, text: 'Avoimet työpaikat' }, stacked: chartType === 'bar' }
                                        },
                                        layout: { padding: 10 },
                                        backgroundColor: '#f7fbfc'
                                    }
                                });
                                // After chart redraw, update dataset visibility and button label
                                if (allHidden) {
                                    chartInstance.data.datasets.forEach(ds => { ds.hidden = true; });
                                    chartInstance.update();
                                    btnToggleDatasets.textContent = 'Näytä kaikki toimialat';
                                } else {
                                    chartInstance.data.datasets.forEach(ds => { ds.hidden = false; });
                                    chartInstance.update();
                                    btnToggleDatasets.textContent = 'Piilota kaikki toimialat';
                                }
                            })
                            .catch(() => {
                                const parent = canvas.parentElement;
                                parent.innerHTML = `<div style='color:#cc3300;text-align:center;font-size:20px;padding:40px 0;'>Ei tietokantayhteyttä</div>`;
                            });
                    }
                    select.addEventListener('change', function () {
                        fetchAndDraw(this.value, currentType);
                    });
                    btnLine.addEventListener('click', function () {
                        currentType = 'line';
                        fetchAndDraw(select.value, currentType);
                        btnLine.style.fontWeight = 'bold';
                        btnBar.style.fontWeight = 'normal';
                    });
                    btnBar.addEventListener('click', function () {
                        currentType = 'bar';
                        fetchAndDraw(select.value, currentType);
                        btnBar.style.fontWeight = 'bold';
                        btnLine.style.fontWeight = 'normal';
                    });
                    // Attach dataset toggle button ONCE
                    if (btnToggleDatasets) {
                        btnToggleDatasets.addEventListener('click', function () {
                            if (!chartInstance) return;
                            allHidden = !allHidden;
                            chartInstance.data.datasets.forEach(ds => { ds.hidden = allHidden; });
                            chartInstance.update();
                            btnToggleDatasets.textContent = allHidden ? 'Näytä kaikki toimialat' : 'Piilota kaikki toimialat';
                        });
                    }
                    // Initial state
                    btnBar.style.fontWeight = 'bold';
                    btnLine.style.fontWeight = 'normal';
                    fetchAndDraw(select.value, currentType);
                });
            </script>
            <p align="center">Lähde: <a
                    href="https://statfin.stat.fi/PxWeb/pxweb/fi/StatFin/StatFin__tyonv/statfin_tyonv_pxt_12tw.px/"
                    target="_blank" title="12tw -- Avoimet työpaikat kuukauden lopussa toimialan mukaan maakunnittain">
                    Tilastokeskus 12tw</a> (työnvälitystilasto, KEHA), viimeisin tilasto tarkistettu lähteestä <b> <span
                        id="avoimet-toimiala-update">...</span></b></p>


            <!-- 
            <br><br> <br>
            <h2 id="bookmark1">Tarkastele avoimia työpaikkoja toimialoittain:</h2><br>
           
            <div class="swiper">
               
                <div class="swiper-wrapper">
                  
                    <div class="swiper-slide" align="center" max-width="50%">
                        <div class="flourish-embed flourish-chart" data-src="visualisation/22517240">
                            <script src="https://public.flourish.studio/resources/embed.js"></script><noscript><img
                                    src="https://public.flourish.studio/visualisation/22517240/thumbnail"
                                    alt="chart visualization" /></noscript>
                        </div>
                    </div>
                    <div class="swiper-slide" id="bookmark4">
                        <div class="flourish-embed flourish-chart" data-src="visualisation/22517613">
                            <script src="https://public.flourish.studio/resources/embed.js"></script><noscript><img
                                    src="https://public.flourish.studio/visualisation/22517613/thumbnail"
                                    alt="chart visualization" /></noscript>
                        </div>
                    </div>
                </div>

               
                <div class="swiper-pagination"></div>

               
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>

            </div> -->


            <p align="center"><br><br>
            <h2>Työllisyyslukuja kunnittain</h2><br>
            </p>
            <iframe title="Työllisyys_tunnusluvut" width="80%" height="400"
                src="https://app.powerbi.com/view?r=eyJrIjoiN2VhZjEyMzAtZTY2Zi00ZDkzLWFiNDEtZmE3NjQwOWMzNzI0IiwidCI6ImM3YjJjZGYxLTcxN2YtNGY3Mi04NGUwLWY2Nzg0Nzk5YTgzNiIsImMiOjh9"
                frameborder="0" allowFullScreen="true"></iframe><br><br>


            <!--             <br><br><br>
            <iframe title="TujoTilastot Ennuste" width="100%" height="720"
                src="https://app.powerbi.com/view?r=eyJrIjoiNWFjYWYwZTMtODFkOS00ZmYzLWFhNTQtMTBmYmRhN2QyOTRhIiwidCI6ImM3YjJjZGYxLTcxN2YtNGY3Mi04NGUwLWY2Nzg0Nzk5YTgzNiIsImMiOjh9"
                frameborder="0" allowFullScreen="true"></iframe> -->
        </div><br>


    </div>
    <!-- Footer ja lisätiedot -->
    <div class="footer">
        <div class="w-container">
            <div class="w-row">
                <div class="spc w-col w-col-4">
                    <h5>Sivuston osiot</h5>
                    <a href="opiskelu.html" class="footer-link">Tilannekuva</a>
                    <a href="ennakointi.html" class="footer-link">Tulevaisuuskuva</a>
                    <a href="info.html" class="footer-link">Tietoa meistä</a>
                    <a href="mailto:info@tulevaisuusluotain.fi;christian@tulevaisuusluotain.fi?subject=Palautetta tulevaisuusluotain-sivuston kautta"" class="
                        footer-link"><b>ANNA PALAUTETTA TAI KEHITYSEHDOTUKSIA</b></a>
                    <a href="mediaseuranta.html" class="footer-link" target="_blank"><b>HÄMEEN ELY-MEDIASEURANTA</b></a>
                    <a href="Saavutettavuusseloste.html" class="footer-link"
                        target="_blank"><b>SAAVUTETTAVUUSSELOSTE</b></a>
                </div>
                <div class="spc w-col w-col-4">
                    <h5>Tilannekuva - osio</h5>
                    <a href="opiskelu.html" class="footer-link">Koulutus</a>
                    <a href="tyollisyys.html" class="footer-link">Työllisyys</a>
                    <a href="vaesto.html" class="footer-link">Väestö</a>
                    <a href="aluekehitys.html" class="footer-link">Elinvoima</a>

                </div>

                <div class=" w-col w-col-4">
                    <h5>Hyödyllisiä linkkejä</h5>
                    <a href="https://www.osaamistarvekompassi.fi" class="footer-link" target="_blank">JOTPA -
                        Osaamistarvekompassi</a>
                    <a href="https://www.oph.fi/fi/palvelut/osaamisen-ennakointifoorumi-oef" target="_blank"
                        class="footer-link">OEF - Osaamisen ennakointifoorumi</a>
                    <a href="https://tyomarkkinatori.fi/teemasivut/tyovoiman-saatavuus-ja-kohtaanto" target="_blank"
                        class="footer-link">Työvoiman saatavuus ja kohtaanto</a>
                    <a href="https://vipunen.fi/fi-fi/ennakointi" class="footer-link" target="_blank">Vipunen /
                        Ennakointi</a>
                    <a href="https://app.powerbi.com/view?r=eyJrIjoiODFkNGVlMDAtMzMxZi00MWI0LWE3YTEtMzM0ZGQzMzliOGNjIiwidCI6ImI0MjZhNDVlLTBiMjYtNGE0MC05MWUxLTVhYjdlODc4OThlYyIsImMiOjh9"
                        class="footer-link" target="_blank"">
                        Hämeen elinvoimakatsaus</a>
                </div>
            </div>
        </div>
    </div>


        <div class=" footer center">

                </div>

                <script
                    src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=663b57613daa22b24eb91975"
                    type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
                    crossorigin="anonymous"></script>


                <script src="webflow.js" type="text/javascript"></script>
                <!-- Chart.js CDN -->
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

                <script type="text/javascript">
                    // Ladataan tuo otsikot.html tiedostosta, kun sitä samaa käytetään niin monessa paikassa
                    function otsikot() {
                        fetch('./otsikot.html')
                            .then(response => response.text())
                            .then(data => {
                                const placeholder = document.getElementById('otsikot-placeholder');
                                placeholder.innerHTML = data;
                            })
                            .catch(error => console.error('Error loading otsikot.html:', error));
                    }
                    otsikot();
                </script>

                <script>
                    // Pienet upotetut sparkline-kaaviot ph-osuus ja kh-osuus
                    document.addEventListener('DOMContentLoaded', function () {
                        // Päijät-Häme sparkline
                        const phCanvas = document.getElementById('tyollisyys-embed-chart');
                        if (phCanvas) {
                            fetch('tyollisyys_historia.php?stat_code=MK07&field=tyottomien_osuus&limit=24')
                                .then(resp => resp.json())
                                .then(data => {
                                    if (!data || !data.labels || !data.data) return;
                                    const labels = data.labels.slice(-24);
                                    const values = data.data.slice(-24);
                                    const minY = Math.floor(Math.min(...values));
                                    const maxY = Math.ceil(Math.max(...values));
                                    new Chart(phCanvas.getContext('2d'), {
                                        type: 'line',
                                        data: {
                                            labels: labels,
                                            datasets: [{
                                                data: values,
                                                borderColor: '#009933',
                                                backgroundColor: 'rgba(0,153,51,0.10)',
                                                fill: true,
                                                pointRadius: 0,
                                                borderWidth: 2,
                                                tension: 0.4
                                            }]
                                        },
                                        options: {
                                            responsive: false,
                                            plugins: { legend: { display: false }, tooltip: { enabled: false } },
                                            scales: {
                                                x: { display: false },
                                                y: { display: false, min: minY, max: maxY }
                                            },
                                            elements: { line: { borderCapStyle: 'round' } },
                                            layout: { padding: 0 },
                                        }
                                    });
                                });
                        }
                        // Kanta-Häme sparkline
                        const khCanvas = document.getElementById('kh-embed-chart');
                        if (khCanvas) {
                            fetch('tyollisyys_historia.php?stat_code=MK05&field=tyottomien_osuus&limit=24')
                                .then(resp => resp.json())
                                .then(data => {
                                    if (!data || !data.labels || !data.data) return;
                                    const labels = data.labels.slice(-24);
                                    const values = data.data.slice(-24);
                                    const minY = Math.floor(Math.min(...values));
                                    const maxY = Math.ceil(Math.max(...values));
                                    new Chart(khCanvas.getContext('2d'), {
                                        type: 'line',
                                        data: {
                                            labels: labels,
                                            datasets: [{
                                                data: values,
                                                borderColor: '#3366cc',
                                                backgroundColor: 'rgba(51,102,204,0.10)',
                                                fill: true,
                                                pointRadius: 0,
                                                borderWidth: 2,
                                                tension: 0.4
                                            }]
                                        },
                                        options: {
                                            responsive: false,
                                            plugins: { legend: { display: false }, tooltip: { enabled: false } },
                                            scales: {
                                                x: { display: false },
                                                y: { display: false, min: minY, max: maxY }
                                            },
                                            elements: { line: { borderCapStyle: 'round' } },
                                            layout: { padding: 0 },
                                        }
                                    });
                                });
                        }
                    });
                    // Haetaan työllisyystilastot dynaamisesti PHP:sta ja päivitetään laatikot sekä summary
                    fetch('tyollisyys.php')
                        .then(resp => resp.json())
                        .then(data => {
                            if (data.maakunnat && data.maakunnat['MK07'] && data.maakunnat['MK05']) {
                                // Päivitetään aikaleimat
                                document.getElementById('stat-aika').textContent = data.aika;
                                document.getElementById('stat-aika2').textContent = data.aika;
                                document.getElementById('stat-aika3').textContent = data.aika;
                                // Päivitetään päivitysaika
                                if (data.paivitys) {
                                    document.getElementById('stat-paivitys').textContent = data.paivitys;
                                    var statPaivitys2 = document.getElementById('stat-paivitys-2');
                                    if (statPaivitys2) statPaivitys2.textContent = data.paivitys;
                                }
                                // Päijät-Häme
                                document.getElementById('ph-osuus').textContent = data.maakunnat['MK07'].tyottomien_osuus;
                                document.getElementById('ph-avoimet').textContent = data.maakunnat['MK07'].uudet_avopaikat;
                                document.getElementById('ph-tyottomat').textContent = data.maakunnat['MK07'].tyottomat_yht;
                                // Kanta-Häme
                                document.getElementById('kh-osuus').textContent = data.maakunnat['MK05'].tyottomien_osuus;
                                document.getElementById('kh-avoimet').textContent = data.maakunnat['MK05'].uudet_avopaikat;
                                document.getElementById('kh-tyottomat').textContent = data.maakunnat['MK05'].tyottomat_yht;
                                // Rakennetaan summary dynaamisesti ELY04 ja SSS arvoilla
                                if (data.maakunnat['ELY04'] && data.maakunnat['SSS']) {
                                    const ely = data.maakunnat['ELY04'];
                                    const sss = data.maakunnat['SSS'];
                                    // Muunna aika (esim. 2025M06 -> kesäkuu 2025)
                                    function formatAika(aika) {
                                        const kuukausiNimet = ['tammikuu', 'helmikuu', 'maaliskuu', 'huhtikuu', 'toukokuu', 'kesäkuu', 'heinäkuu', 'elokuu', 'syyskuu', 'lokakuu', 'marraskuu', 'joulukuu'];
                                        const match = aika.match(/(\d{4})M(\d{2})/);
                                        if (match) {
                                            const vuosi = match[1];
                                            const kk = parseInt(match[2], 10);
                                            const kuukausi = kuukausiNimet[kk - 1] || kk;
                                            return `${kuukausi} ${vuosi}`;
                                        }
                                        return aika;
                                    }
                                    const aikaTeksti = formatAika(data.aika);
                                    document.getElementById('tyollisyys-summary').innerHTML =
                                        `<b>${aikaTeksti}</b>: Hämeen ELY-alueella työttömyysaste oli <span id="ely-tyottomyysaste" style="text-decoration:underline;cursor:pointer;font-weight:bold;">${ely.tyottomien_osuus} %</span>, (koko maa <span id="sss-tyottomyysaste" style="text-decoration:underline;cursor:pointer;font-weight:bold;">${sss.tyottomien_osuus} %</span>). ` +
                                        `Työttömiä työnhakijoita oli <span id="ely-tyottomat" style="text-decoration:underline;cursor:pointer;font-weight:bold;">${ely.tyottomat_yht}</span>.`;



                                    // --- Popup chart logic for summary values ---
                                    setTimeout(function () {
                                        // ELY työttömyysaste
                                        const elyTyottomyysSpan = document.getElementById('ely-tyottomyysaste');
                                        if (elyTyottomyysSpan) {
                                            let popup = document.createElement('div');
                                            popup.id = 'ely-tyottomyysaste-popup';
                                            popup.style.display = 'none';
                                            popup.style.position = 'fixed';
                                            popup.style.zIndex = '1000';
                                            popup.style.background = '#fff';
                                            popup.style.border = '1px solid #ccc';
                                            popup.style.padding = '10px';
                                            popup.style.borderRadius = '8px';
                                            popup.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
                                            popup.innerHTML = '<canvas id="ely-tyottomyysaste-chart" width="400" height="180"></canvas><div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">ELY-alueen työttömyysaste - 12kk</div>';
                                            document.body.appendChild(popup);
                                            let chartInstance = null;
                                            elyTyottomyysSpan.addEventListener('mouseover', function (e) {
                                                popup.style.display = 'block';
                                                let x = e.clientX + 40;
                                                let y = e.clientY - 220;
                                                if (x + 400 > window.innerWidth) x = window.innerWidth - 408;
                                                if (x < 8) x = 8;
                                                if (y < 8) y = 8;
                                                popup.style.left = x + 'px';
                                                popup.style.top = y + 'px';
                                                if (!chartInstance) {
                                                    fetch('tyollisyys_historia.php?stat_code=ELY04&field=tyottomien_osuus&limit=12')
                                                        .then(resp => resp.json())
                                                        .then(hist => {
                                                            const labels = hist.labels.map(l => l.replace(/M(\d{2})/, m => {
                                                                const kk = parseInt(m.slice(1), 10);
                                                                const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                                                                return ' ' + (kuukausiNimet[kk - 1] || m);
                                                            }));
                                                            const data = hist.data;
                                                            const minY = Math.floor(Math.min(...data) - 1);
                                                            const maxY = Math.ceil(Math.max(...data) + 1);
                                                            const ctx = document.getElementById('ely-tyottomyysaste-chart').getContext('2d');
                                                            chartInstance = new Chart(ctx, {
                                                                type: 'line',
                                                                data: {
                                                                    labels: labels,
                                                                    datasets: [{
                                                                        label: 'Työttömyysaste (%)',
                                                                        data: data,
                                                                        borderColor: '#0077cc',
                                                                        backgroundColor: 'rgba(0,119,204,0.1)',
                                                                        fill: true,
                                                                        pointRadius: 3
                                                                    }]
                                                                },
                                                                options: {
                                                                    responsive: false,
                                                                    plugins: { legend: { display: false } },
                                                                    scales: {
                                                                        x: { title: { display: true, text: 'Kuukausi' } },
                                                                        y: { title: { display: true, text: '%' }, min: minY, max: maxY }
                                                                    }
                                                                }
                                                            });
                                                        });
                                                }
                                            });
                                            elyTyottomyysSpan.addEventListener('mousemove', function (e) {
                                                let x = e.clientX + 40;
                                                let y = e.clientY - 220;
                                                if (x + 400 > window.innerWidth) x = window.innerWidth - 408;
                                                if (x < 8) x = 8;
                                                if (y < 8) y = 8;
                                                popup.style.left = x + 'px';
                                                popup.style.top = y + 'px';
                                            });
                                            elyTyottomyysSpan.addEventListener('mouseout', function () {
                                                popup.style.display = 'none';
                                            });
                                        }
                                        // SSS työttömyysaste
                                        const sssTyottomyysSpan = document.getElementById('sss-tyottomyysaste');
                                        if (sssTyottomyysSpan) {
                                            let popup = document.createElement('div');
                                            popup.id = 'sss-tyottomyysaste-popup';
                                            popup.style.display = 'none';
                                            popup.style.position = 'fixed';
                                            popup.style.zIndex = '1000';
                                            popup.style.background = '#fff';
                                            popup.style.border = '1px solid #ccc';
                                            popup.style.padding = '10px';
                                            popup.style.borderRadius = '8px';
                                            popup.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
                                            popup.innerHTML = '<canvas id="sss-tyottomyysaste-chart" width="400" height="180"></canvas><div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">Koko maan työttömyysaste - 12kk</div>';
                                            document.body.appendChild(popup);
                                            let chartInstance = null;
                                            sssTyottomyysSpan.addEventListener('mouseover', function (e) {
                                                popup.style.display = 'block';
                                                let x = e.clientX + 40;
                                                let y = e.clientY - 220;
                                                if (x + 400 > window.innerWidth) x = window.innerWidth - 408;
                                                if (x < 8) x = 8;
                                                if (y < 8) y = 8;
                                                popup.style.left = x + 'px';
                                                popup.style.top = y + 'px';
                                                if (!chartInstance) {
                                                    fetch('tyollisyys_historia.php?stat_code=SSS&field=tyottomien_osuus&limit=12')
                                                        .then(resp => resp.json())
                                                        .then(hist => {
                                                            const labels = hist.labels.map(l => l.replace(/M(\d{2})/, m => {
                                                                const kk = parseInt(m.slice(1), 10);
                                                                const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                                                                return ' ' + (kuukausiNimet[kk - 1] || m);
                                                            }));
                                                            const data = hist.data;
                                                            const minY = Math.floor(Math.min(...data) - 1);
                                                            const maxY = Math.ceil(Math.max(...data) + 1);
                                                            const ctx = document.getElementById('sss-tyottomyysaste-chart').getContext('2d');
                                                            chartInstance = new Chart(ctx, {
                                                                type: 'line',
                                                                data: {
                                                                    labels: labels,
                                                                    datasets: [{
                                                                        label: 'Työttömyysaste (%)',
                                                                        data: data,
                                                                        borderColor: '#009933',
                                                                        backgroundColor: 'rgba(0,153,51,0.1)',
                                                                        fill: true,
                                                                        pointRadius: 3
                                                                    }]
                                                                },
                                                                options: {
                                                                    responsive: false,
                                                                    plugins: { legend: { display: false } },
                                                                    scales: {
                                                                        x: { title: { display: true, text: 'Kuukausi' } },
                                                                        y: { title: { display: true, text: '%' }, min: minY, max: maxY }
                                                                    }
                                                                }
                                                            });
                                                        });
                                                }
                                            });
                                            sssTyottomyysSpan.addEventListener('mousemove', function (e) {
                                                let x = e.clientX + 40;
                                                let y = e.clientY - 220;
                                                if (x + 400 > window.innerWidth) x = window.innerWidth - 408;
                                                if (x < 8) x = 8;
                                                if (y < 8) y = 8;
                                                popup.style.left = x + 'px';
                                                popup.style.top = y + 'px';
                                            });
                                            sssTyottomyysSpan.addEventListener('mouseout', function () {
                                                popup.style.display = 'none';
                                            });
                                        }
                                        // ELY työttömät työnhakijat
                                        const elyTyottomatSpan = document.getElementById('ely-tyottomat');
                                        if (elyTyottomatSpan) {
                                            let popup = document.createElement('div');
                                            popup.id = 'ely-tyottomat-popup';
                                            popup.style.display = 'none';
                                            popup.style.position = 'fixed';
                                            popup.style.zIndex = '1000';
                                            popup.style.background = '#fff';
                                            popup.style.border = '1px solid #ccc';
                                            popup.style.padding = '10px';
                                            popup.style.borderRadius = '8px';
                                            popup.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
                                            popup.innerHTML = '<canvas id="ely-tyottomat-chart" width="400" height="180"></canvas><div style="text-align:center;font-size:15px;margin-top:8px;color:#333;">ELY-alueen työttömät työnhakijat - 12kk</div>';
                                            document.body.appendChild(popup);
                                            let chartInstance = null;
                                            elyTyottomatSpan.addEventListener('mouseover', function (e) {
                                                popup.style.display = 'block';
                                                let x = e.clientX + 40;
                                                let y = e.clientY - 220;
                                                if (x + 400 > window.innerWidth) x = window.innerWidth - 408;
                                                if (x < 8) x = 8;
                                                if (y < 8) y = 8;
                                                popup.style.left = x + 'px';
                                                popup.style.top = y + 'px';
                                                if (!chartInstance) {
                                                    fetch('tyollisyys_historia.php?stat_code=ELY04&field=tyottomat_yht&limit=12')
                                                        .then(resp => resp.json())
                                                        .then(hist => {
                                                            const labels = hist.labels.map(l => l.replace(/M(\d{2})/, m => {
                                                                const kk = parseInt(m.slice(1), 10);
                                                                const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                                                                return ' ' + (kuukausiNimet[kk - 1] || m);
                                                            }));
                                                            const data = hist.data;
                                                            const minY = Math.floor(Math.min(...data) - 1);
                                                            const maxY = Math.ceil(Math.max(...data) + 1);
                                                            const ctx = document.getElementById('ely-tyottomat-chart').getContext('2d');
                                                            chartInstance = new Chart(ctx, {
                                                                type: 'line',
                                                                data: {
                                                                    labels: labels,
                                                                    datasets: [{
                                                                        label: 'Työttömät työnhakijat',
                                                                        data: data,
                                                                        borderColor: '#cc3300',
                                                                        backgroundColor: 'rgba(204,51,0,0.1)',
                                                                        fill: true,
                                                                        pointRadius: 3
                                                                    }]
                                                                },
                                                                options: {
                                                                    responsive: false,
                                                                    plugins: { legend: { display: false } },
                                                                    scales: {
                                                                        x: { title: { display: true, text: 'Kuukausi' } },
                                                                        y: { title: { display: true, text: 'Lkm' }, min: minY, max: maxY }
                                                                    }
                                                                }
                                                            });
                                                        });
                                                }
                                            });
                                            elyTyottomatSpan.addEventListener('mousemove', function (e) {
                                                let x = e.clientX + 40;
                                                let y = e.clientY - 220;
                                                if (x + 400 > window.innerWidth) x = window.innerWidth - 408;
                                                if (x < 8) x = 8;
                                                if (y < 8) y = 8;
                                                popup.style.left = x + 'px';
                                                popup.style.top = y + 'px';
                                            });
                                            elyTyottomatSpan.addEventListener('mouseout', function () {
                                                popup.style.display = 'none';
                                            });
                                        }
                                    }, 0);
                                }
                            }
                        })
                        .catch(e => { /* virheenkäsittely, esim. näytä virheilmoitus */ });

                    // Chart popup logic for ph-osuus
                    document.addEventListener('DOMContentLoaded', function () {
                        // Chart popup logic for Päijät-Häme työttömät työnhakijat
                        const phTyottomatSpan = document.getElementById('ph-tyottomat');
                        const phTyottomatChartPopup = document.getElementById('ph-tyottomat-chart-popup');
                        let phTyottomatChartInstance = null;
                        phTyottomatChartPopup.style.position = 'fixed';
                        function positionPhTyottomatChartPopup(e) {
                            const popupWidth = 400;
                            const popupHeight = 220;
                            let x = e.clientX - 50;
                            let y = e.clientY - popupHeight - 30;
                            if (x + popupWidth > window.innerWidth) x = window.innerWidth - popupWidth - 8;
                            if (x < 8) x = 8;
                            if (y + popupHeight > window.innerHeight) y = window.innerHeight - popupHeight - 8;
                            if (y < 8) y = 8;
                            phTyottomatChartPopup.style.left = x + 'px';
                            phTyottomatChartPopup.style.top = y + 'px';
                        }
                        let phTyottomatChartDataLoaded = false;
                        let phTyottomatChartLabels = [];
                        let phTyottomatChartData = [];
                        phTyottomatSpan.addEventListener('mouseover', function (e) {
                            phTyottomatChartPopup.style.display = 'block';
                            positionPhTyottomatChartPopup(e);
                            if (!phTyottomatChartDataLoaded) {
                                fetch('tyollisyys_historia.php?stat_code=MK07&field=tyottomatlopussa')
                                    .then(resp => resp.json())
                                    .then(hist => {
                                        phTyottomatChartLabels = hist.labels.map(l => l.replace(/M(\d{2})/, m => {
                                            const kk = parseInt(m.slice(1), 10);
                                            const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                                            return ' ' + (kuukausiNimet[kk - 1] || m);
                                        }));
                                        phTyottomatChartData = hist.data;
                                        phTyottomatChartDataLoaded = true;
                                        const minY = Math.floor(Math.min(...phTyottomatChartData) - 1);
                                        const maxY = Math.ceil(Math.max(...phTyottomatChartData) + 1);
                                        const ctx = document.getElementById('ph-tyottomat-chart').getContext('2d');
                                        phTyottomatChartInstance = new Chart(ctx, {
                                            type: 'line',
                                            data: {
                                                labels: phTyottomatChartLabels,
                                                datasets: [{
                                                    label: 'Työttömät työnhakijat',
                                                    data: phTyottomatChartData,
                                                    borderColor: '#cc3300',
                                                    backgroundColor: 'rgba(204,51,0,0.1)',
                                                    fill: true,
                                                    pointRadius: 3
                                                }]
                                            },
                                            options: {
                                                responsive: false,
                                                plugins: { legend: { display: false } },
                                                scales: {
                                                    x: { title: { display: true, text: 'Kuukausi' } },
                                                    y: { title: { display: true, text: 'Lkm' }, min: minY, max: maxY }
                                                }
                                            }
                                        });
                                    });
                            }
                        });
                        phTyottomatSpan.addEventListener('mousemove', function (e) {
                            positionPhTyottomatChartPopup(e);
                        });
                        phTyottomatSpan.addEventListener('mouseout', function () {
                            phTyottomatChartPopup.style.display = 'none';
                        });

                        // Chart popup logic for Kanta-Häme työttömät työnhakijat
                        const khTyottomatSpan = document.getElementById('kh-tyottomat');
                        const khTyottomatChartPopup = document.getElementById('kh-tyottomat-chart-popup');
                        let khTyottomatChartInstance = null;
                        khTyottomatChartPopup.style.position = 'fixed';
                        function positionKhTyottomatChartPopup(e) {
                            const popupWidth = 400;
                            const popupHeight = 220;
                            let x = e.clientX - 50;
                            let y = e.clientY - popupHeight - 30;
                            if (x + popupWidth > window.innerWidth) x = window.innerWidth - popupWidth - 8;
                            if (x < 8) x = 8;
                            if (y + popupHeight > window.innerHeight) y = window.innerHeight - popupHeight - 8;
                            if (y < 8) y = 8;
                            khTyottomatChartPopup.style.left = x + 'px';
                            khTyottomatChartPopup.style.top = y + 'px';
                        }
                        let khTyottomatChartDataLoaded = false;
                        let khTyottomatChartLabels = [];
                        let khTyottomatChartData = [];
                        khTyottomatSpan.addEventListener('mouseover', function (e) {
                            khTyottomatChartPopup.style.display = 'block';
                            positionKhTyottomatChartPopup(e);
                            if (!khTyottomatChartDataLoaded) {
                                fetch('tyollisyys_historia.php?stat_code=MK05&field=tyottomatlopussa')
                                    .then(resp => resp.json())
                                    .then(hist => {
                                        khTyottomatChartLabels = hist.labels.map(l => l.replace(/M(\d{2})/, m => {
                                            const kk = parseInt(m.slice(1), 10);
                                            const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                                            return ' ' + (kuukausiNimet[kk - 1] || m);
                                        }));
                                        khTyottomatChartData = hist.data;
                                        khTyottomatChartDataLoaded = true;
                                        const minY = Math.floor(Math.min(...khTyottomatChartData) - 1);
                                        const maxY = Math.ceil(Math.max(...khTyottomatChartData) + 1);
                                        const ctx = document.getElementById('kh-tyottomat-chart').getContext('2d');
                                        khTyottomatChartInstance = new Chart(ctx, {
                                            type: 'line',
                                            data: {
                                                labels: khTyottomatChartLabels,
                                                datasets: [{
                                                    label: 'Työttömät työnhakijat',
                                                    data: khTyottomatChartData,
                                                    borderColor: '#cc3300',
                                                    backgroundColor: 'rgba(204,51,0,0.1)',
                                                    fill: true,
                                                    pointRadius: 3
                                                }]
                                            },
                                            options: {
                                                responsive: false,
                                                plugins: { legend: { display: false } },
                                                scales: {
                                                    x: { title: { display: true, text: 'Kuukausi' } },
                                                    y: { title: { display: true, text: 'Lkm' }, min: minY, max: maxY }
                                                }
                                            }
                                        });
                                    });
                            }
                        });
                        khTyottomatSpan.addEventListener('mousemove', function (e) {
                            positionKhTyottomatChartPopup(e);
                        });
                        khTyottomatSpan.addEventListener('mouseout', function () {
                            khTyottomatChartPopup.style.display = 'none';
                        });
                        // Chart popup logic for Päijät-Häme avoimet työpaikat
                        const phAvoimetSpan = document.getElementById('ph-avoimet');
                        const phAvoimetChartPopup = document.getElementById('ph-avoimet-chart-popup');
                        let phAvoimetChartInstance = null;
                        phAvoimetChartPopup.style.position = 'fixed';
                        function positionPhAvoimetChartPopup(e) {
                            const popupWidth = 400;
                            const popupHeight = 220;
                            let x = e.clientX + 40;
                            let y = e.clientY - popupHeight;
                            if (x + popupWidth > window.innerWidth) x = window.innerWidth - popupWidth - 8;
                            if (x < 8) x = 8;
                            if (y + popupHeight > window.innerHeight) y = window.innerHeight - popupHeight - 8;
                            if (y < 8) y = 8;
                            phAvoimetChartPopup.style.left = x + 'px';
                            phAvoimetChartPopup.style.top = y + 'px';
                        }
                        let phAvoimetChartDataLoaded = false;
                        let phAvoimetChartLabels = [];
                        let phAvoimetChartData = [];
                        phAvoimetSpan.addEventListener('mouseover', function (e) {
                            phAvoimetChartPopup.style.display = 'block';
                            positionPhAvoimetChartPopup(e);
                            if (!phAvoimetChartDataLoaded) {
                                fetch('tyollisyys_historia.php?stat_code=MK07&field=uudetavp')
                                    .then(resp => resp.json())
                                    .then(hist => {
                                        phAvoimetChartLabels = hist.labels.map(l => l.replace(/M(\d{2})/, m => {
                                            const kk = parseInt(m.slice(1), 10);
                                            const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                                            return ' ' + (kuukausiNimet[kk - 1] || m);
                                        }));
                                        phAvoimetChartData = hist.data;
                                        phAvoimetChartDataLoaded = true;
                                        const minY = Math.floor(Math.min(...phAvoimetChartData) - 1);
                                        const maxY = Math.ceil(Math.max(...phAvoimetChartData) + 1);
                                        const ctx = document.getElementById('ph-avoimet-chart').getContext('2d');
                                        phAvoimetChartInstance = new Chart(ctx, {
                                            type: 'line',
                                            data: {
                                                labels: phAvoimetChartLabels,
                                                datasets: [{
                                                    label: 'Uudet avoimet työpaikat',
                                                    data: phAvoimetChartData,
                                                    borderColor: '#009933',
                                                    backgroundColor: 'rgba(0,153,51,0.1)',
                                                    fill: true,
                                                    pointRadius: 3
                                                }]
                                            },
                                            options: {
                                                responsive: false,
                                                plugins: { legend: { display: false } },
                                                scales: {
                                                    x: { title: { display: true, text: 'Kuukausi' } },
                                                    y: { title: { display: true, text: 'Lkm' }, min: minY, max: maxY }
                                                }
                                            }
                                        });
                                    });
                            }
                        });
                        phAvoimetSpan.addEventListener('mousemove', function (e) {
                            positionPhAvoimetChartPopup(e);
                        });
                        phAvoimetSpan.addEventListener('mouseout', function () {
                            phAvoimetChartPopup.style.display = 'none';
                        });

                        // Chart popup logic for Kanta-Häme avoimet työpaikat
                        const khAvoimetSpan = document.getElementById('kh-avoimet');
                        const khAvoimetChartPopup = document.getElementById('kh-avoimet-chart-popup');
                        let khAvoimetChartInstance = null;
                        khAvoimetChartPopup.style.position = 'fixed';
                        function positionKhAvoimetChartPopup(e) {
                            const popupWidth = 400;
                            const popupHeight = 220;
                            let x = e.clientX + 40;
                            let y = e.clientY - popupHeight;
                            if (x + popupWidth > window.innerWidth) x = window.innerWidth - popupWidth - 8;
                            if (x < 8) x = 8;
                            if (y + popupHeight > window.innerHeight) y = window.innerHeight - popupHeight - 8;
                            if (y < 8) y = 8;
                            khAvoimetChartPopup.style.left = x + 'px';
                            khAvoimetChartPopup.style.top = y + 'px';
                        }
                        let khAvoimetChartDataLoaded = false;
                        let khAvoimetChartLabels = [];
                        let khAvoimetChartData = [];
                        khAvoimetSpan.addEventListener('mouseover', function (e) {
                            khAvoimetChartPopup.style.display = 'block';
                            positionKhAvoimetChartPopup(e);
                            if (!khAvoimetChartDataLoaded) {
                                fetch('tyollisyys_historia.php?stat_code=MK05&field=uudetavp')
                                    .then(resp => resp.json())
                                    .then(hist => {
                                        khAvoimetChartLabels = hist.labels.map(l => l.replace(/M(\d{2})/, m => {
                                            const kk = parseInt(m.slice(1), 10);
                                            const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                                            return ' ' + (kuukausiNimet[kk - 1] || m);
                                        }));
                                        khAvoimetChartData = hist.data;
                                        khAvoimetChartDataLoaded = true;
                                        const minY = Math.floor(Math.min(...khAvoimetChartData) - 1);
                                        const maxY = Math.ceil(Math.max(...khAvoimetChartData) + 1);
                                        const ctx = document.getElementById('kh-avoimet-chart').getContext('2d');
                                        khAvoimetChartInstance = new Chart(ctx, {
                                            type: 'line',
                                            data: {
                                                labels: khAvoimetChartLabels,
                                                datasets: [{
                                                    label: 'Uudet avoimet työpaikat',
                                                    data: khAvoimetChartData,
                                                    borderColor: '#009933',
                                                    backgroundColor: 'rgba(0,153,51,0.1)',
                                                    fill: true,
                                                    pointRadius: 3
                                                }]
                                            },
                                            options: {
                                                responsive: false,
                                                plugins: { legend: { display: false } },
                                                scales: {
                                                    x: { title: { display: true, text: 'Kuukausi' } },
                                                    y: { title: { display: true, text: 'Lkm' }, min: minY, max: maxY }
                                                }
                                            }
                                        });
                                    });
                            }
                        });
                        khAvoimetSpan.addEventListener('mousemove', function (e) {
                            positionKhAvoimetChartPopup(e);
                        });
                        khAvoimetSpan.addEventListener('mouseout', function () {
                            khAvoimetChartPopup.style.display = 'none';
                        });
                        // Kanta-Häme chart popup logic
                        const khOsuusSpan = document.getElementById('kh-osuus');
                        const khChartPopup = document.getElementById('kh-osuus-chart-popup');
                        let khChartInstance = null;
                        khChartPopup.style.position = 'fixed';
                        function positionKhChartPopup(e) {
                            const popupWidth = 400;
                            const popupHeight = 220;
                            let x = e.clientX + 40;
                            let y = e.clientY - popupHeight;
                            if (x + popupWidth > window.innerWidth) x = window.innerWidth - popupWidth - 8;
                            if (x < 8) x = 8;
                            if (y + popupHeight > window.innerHeight) y = window.innerHeight - popupHeight - 8;
                            if (y < 8) y = 8;
                            khChartPopup.style.left = x + 'px';
                            khChartPopup.style.top = y + 'px';
                        }
                        let khChartDataLoaded = false;
                        let khChartLabels = [];
                        let khChartData = [];
                        khOsuusSpan.addEventListener('mouseover', function (e) {
                            khChartPopup.style.display = 'block';
                            positionKhChartPopup(e);
                            if (!khChartDataLoaded) {
                                fetch('tyollisyys_historia.php?stat_code=MK05')
                                    .then(resp => resp.json())
                                    .then(hist => {
                                        khChartLabels = hist.labels.map(l => l.replace(/M(\d{2})/, m => {
                                            const kk = parseInt(m.slice(1), 10);
                                            const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                                            return ' ' + (kuukausiNimet[kk - 1] || m);
                                        }));
                                        khChartData = hist.data;
                                        khChartDataLoaded = true;
                                        // Dynamic scale
                                        const minY = Math.floor(Math.min(...khChartData) - 1);
                                        const maxY = Math.ceil(Math.max(...khChartData) + 1);
                                        const ctx = document.getElementById('kh-osuus-chart').getContext('2d');
                                        khChartInstance = new Chart(ctx, {
                                            type: 'line',
                                            data: {
                                                labels: khChartLabels,
                                                datasets: [{
                                                    label: 'Työttömien osuus (%)',
                                                    data: khChartData,
                                                    borderColor: '#0077cc',
                                                    backgroundColor: 'rgba(0,119,204,0.1)',
                                                    fill: true,
                                                    pointRadius: 3
                                                }]
                                            },
                                            options: {
                                                responsive: false,
                                                plugins: { legend: { display: false } },
                                                scales: {
                                                    x: { title: { display: true, text: 'Kuukausi' } },
                                                    y: { title: { display: true, text: '%' }, min: minY, max: maxY }
                                                }
                                            }
                                        });
                                    });
                            }
                        });
                        khOsuusSpan.addEventListener('mousemove', function (e) {
                            positionKhChartPopup(e);
                        });
                        khOsuusSpan.addEventListener('mouseout', function () {
                            khChartPopup.style.display = 'none';
                        });
                        const phOsuusSpan = document.getElementById('ph-osuus');
                        const chartPopup = document.getElementById('ph-osuus-chart-popup');
                        let chartInstance = null;

                        // Use fixed positioning for popup so it always appears next to mouse pointer, regardless of scroll/zoom/monitor
                        chartPopup.style.position = 'fixed';
                        function positionChartPopup(e) {
                            const popupWidth = 400;
                            const popupHeight = 220;
                            let x = e.clientX + 40;
                            let y = e.clientY - popupHeight;
                            // Clamp to viewport horizontally
                            if (x + popupWidth > window.innerWidth) x = window.innerWidth - popupWidth - 8;
                            if (x < 8) x = 8;
                            // Clamp to viewport vertically
                            if (y + popupHeight > window.innerHeight) y = window.innerHeight - popupHeight - 8;
                            if (y < 8) y = 8;
                            chartPopup.style.left = x + 'px';
                            chartPopup.style.top = y + 'px';
                        }

                        let chartDataLoaded = false;
                        let chartLabels = [];
                        let chartData = [];

                        phOsuusSpan.addEventListener('mouseover', function (e) {
                            chartPopup.style.display = 'block';
                            positionChartPopup(e);
                            // Fetch real data only once
                            if (!chartDataLoaded) {
                                fetch('tyollisyys_historia.php')
                                    .then(resp => resp.json())
                                    .then(hist => {
                                        chartLabels = hist.labels.map(l => l.replace(/M(\d{2})/, m => {
                                            const kk = parseInt(m.slice(1), 10);
                                            const kuukausiNimet = ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'];
                                            return ' ' + (kuukausiNimet[kk - 1] || m);
                                        }));
                                        chartData = hist.data;
                                        chartDataLoaded = true;
                                        // Dynamic scale
                                        const minY = Math.floor(Math.min(...chartData) - 1);
                                        const maxY = Math.ceil(Math.max(...chartData) + 1);
                                        // Draw chart
                                        const ctx = document.getElementById('ph-osuus-chart').getContext('2d');
                                        chartInstance = new Chart(ctx, {
                                            type: 'line',
                                            data: {
                                                labels: chartLabels,
                                                datasets: [{
                                                    label: 'Työttömien osuus (%)',
                                                    data: chartData,
                                                    borderColor: '#0077cc',
                                                    backgroundColor: 'rgba(0,119,204,0.1)',
                                                    fill: true,
                                                    pointRadius: 3
                                                }]
                                            },
                                            options: {
                                                responsive: false,
                                                plugins: { legend: { display: false } },
                                                scales: {
                                                    x: { title: { display: true, text: 'Kuukausi' } },
                                                    y: { title: { display: true, text: '%' }, min: minY, max: maxY }
                                                }
                                            }
                                        });
                                    });
                            }
                        });

                        phOsuusSpan.addEventListener('mousemove', function (e) {
                            positionChartPopup(e);
                        });

                        phOsuusSpan.addEventListener('mouseout', function () {
                            chartPopup.style.display = 'none';
                        });
                    });
                </script>

</body>

</html>