<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<link href="img/favicon.ico" rel="shortcut icon" type="image/x-icon" />

<html data-wf-domain="hameen-osaamistarpeiden-ennakointi.webflow.io" data-wf-page="663b57623daa22b24eb919a5"
    data-wf-site="663b57613daa22b24eb91975" data-wf-status="1" lang="fi">

<head>
    <script type="text/javascript">
        // Ladataan tuo header.html (head) tiedostosta, kun sitä samaa käytetään niin monessa paikassa
        // muokkaile sitä jos haluat joka sivun yläosaan muutoksia
        function header() {
            fetch('./header.html')
                .then(response => response.text())
                .then(data => {
                    const head = document.head;
                    const headerContent = document.createElement('div');
                    headerContent.innerHTML = data;
                    head.appendChild(headerContent);
                })
                .catch(error => console.error('Error loading header.html:', error));
        }
        header();
    </script>
</head>

<body>



    <div data-collapse="medium" data-animation="default" data-duration="400" data-easing="ease" data-easing2="ease"
        role="banner" class="navigation-bar w-nav">
        <div class="w-container"> <a href="index.html" aria-current="page" class="brand-link w-nav-brand w--current">
                <img src="img/2logo-tulevaisuusluotain.png" width="170">
                <nav role="navigation" class="navigation-menu w-nav-menu"><a href="index.html" aria-current="page"
                        class="brand-link w-nav-brand w--current">
                        <img src="img/esr.jpg" width="350"><a></a>
                </nav>

                <div class="hamburger-button w-nav-button">
                    <img src="img/esr2.jpg" width="100">
                </div>
        </div>

        <div class="hero-section centered">
            <div data-w-id="e464d218-f801-55d1-1f50-7da00b5bfb8f" style="opacity:0" class="w-container">
                <h1 data-ix="fade-in-bottom-page-loads" class="hero-heading">TULEVAISUUSLUOTAIN</h1>

                <div data-ix="fade-in-bottom-page-loads" id="otsikot-placeholder">
                    <!--OTSIKOIDEN PLACEHOLDER - OTSIKOT.HTML -->
                </div>

            </div>
        </div>

        <div class="footer center"> <b>
                <a href="opiskelu.html" class="sivut-button"><b> KOULUTUS </b><br>
                    Tietoa koulutustasosta,<br> opiskelijamääristä ja <br> opiskelijoiden sijoittumisesta
                    <br>valmistumisen jälkeen.</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="tyollisyys.html" class="sivut-button"><b>TYÖLLISYYS</b> <br>Tietoa avoimista <br> työpaikoista
                    ja työttömistä <br> työnhakijoista.</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="vaesto.html" class="sivut-button"> <b>VÄESTÖ</b> <br>Tarkastele Hämeen <br>väestörakennetta ja
                    <br> väestön kehitystä</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="aluekehitys.html" class="button"><b>ELINVOIMA </b><br>Alueen ostovoimasta,<br>
                    toimialarakenteesta sekä <br>aloittaneista <br> ja lopettaneista yrityksistä.</a>

            </b>
            </b>
        </div><br><br>


        <div class="textContainer">
            <h2>Kanta-Häme</h2>
            <table>
                <tr>
                    <td>Kanta-Hämeen elinkeinorakenne on monipuolinen. Metalliteollisuus, koneet ja laitteet sekä
                        paperin ja
                        kartonkituotteiden valmistus ovat merkittäviä työllistäjiä. Lisäksi elintarviketeollisuus
                        työllistää noin
                        joka kuudennen työssäkäyvän. Vaikka sekä yleinen talouden taantuma että erityisesti teollisuuden
                        haasteet
                        esimerkiksi energian ja raaka-aineiden hintojen nousun vuoksi ovat luoneet alueen metalli- ja
                        konepajateollisuudelle
                        haasteita, uusia mahdollisuuksia ja positiivisia signaaleita on näkyvissä. Maakunnassa toimivaa
                        puolustusteollisuuden keskittymää johdetaan Riihimäki-vetoisesti, mikä entisestään vahvistaa
                        maakunnan
                        yhteistä kilpailukykyä. Julkisen sektorin leikkauksista huolimatta Hämeenlinnalla on edelleen
                        vahva asema
                        hallinnollisena keskuksena. Vihreän siirtymän aurinko- ja tuulivoimahankkeet ennakoivat alueelle
                        tehtäviä investointeja.
                        Forssan seudun kiertotalouden osaamiskeskittymä vahvistaa alueen vihreää siirtymää.

                        <br>*LÄHDE: Alueelliset kehitysnäkymät • 2025:19
                    </td>
                    <td style="width:45%"><img src="img/kanta-elinvoima.png" alt="Kanta-Hämeen elinkeinorakenne"
                            title="Kanta-Hämeen elinkeinorakenne" width="400"></td>
                </tr>
            </table>

        </div><br><br>
        <div class="textContainer">
            <h2>Päijät-Häme</h2>
            <table>
                <tr>
                    <td style="width:45%"><img src="img/paijat-elinvoima.png" alt="Kanta-Hämeen elinkeinorakenne"
                            title="Kanta-Hämeen elinkeinorakenne" width="400"></td>
                    <td>
                        Päijät-Hämeessä työllistäviä toimialoja ovat erityisesti rakentamisen ja teollisuuden toimialat.
                        Talonrakentaminen ja erikoistunut rakennustoiminta sekä sahatavaran, metallituotteiden sekä
                        koneiden ja laitteiden valmistus työllistävät alueella tuhansia henkilöitä. Maakunnassa toimii
                        myös useita
                        elinvoimaisia toimialakeskittymiä. Toimialakeskittymien kannalta on olennaista, että alueella
                        toimivat elinvoimainen LUT-yliopisto ja LAB-ammattikorkeakoulu. Päijät-Hämeessä tavoitellaankin
                        yritysten
                        TKI-investointien kaksinkertaistamista kahteensataan miljoonaan euroon vuoteen 2027 mennessä.
                        Lahden seudulla on
                        vahva perinne valmistavassa teollisuudessa, elintarviketeollisuudessa, muotoilussa ja
                        ympäristövastuullisuudessa. Kestävä kehitys, ympäristöteknologian innovaatiot sekä
                        hiilidioksidin talteenotto ja hyödyntäminen ovat
                        luomassa elinvoimaa ympäristöosaamisen keskittymälle. Lahdessa sijaitseva Muotoiluinstituutti on
                        merkittävä toimija teollisen muotoilun alalla. Alueen elinvoimaveturina toimii sähköisen
                        liikenteen klusteri ja sen
                        kärkenä raskaan liikenteen sähköistämisratkaisuja valmistava Kempower. Myös liikunnan ympärille
                        rakentuva urheilumatkailu on merkittävä elinvoimatekijä.
                        <br>*LÄHDE: Alueelliset kehitysnäkymät • 2025:19
                    </td>
                </tr>
            </table>
        </div>



        <!-- uusi chart , Alueen työpaikat tähän -->
        <br><br>

        <div id="bookmark-alueentyopaikat"
            style="max-width:1240px;margin:0 auto 40px auto;background:#f7fbfc;padding:20px;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.10);">
            <h3 style="text-align:center;">Alueella työssäkäyvät (työpaikat) kunnittain</h3>
            <div style="text-align:center;margin-bottom:12px;"><br><br>
                <!--  <label for="alueentyopaikat-region-select"><b>Valitse alue:</b></label> -->
                <select id="alueentyopaikat-region-select"
                    style="font-size:16px;padding:4px 12px;border-radius:6px;margin-right:24px;">
                    <option value="all" selected>Koko Häme</option>
                    <option value="1">Päijät-Häme</option>
                    <option value="2">Kanta-Häme</option>
                </select>
                <b>Kaaviotyyppi:</b>
                <button id="alueentyopaikat-type-bar" type="button"
                    style="font-size:15px;padding:4px 16px;border-radius:6px;margin-right:8px;background:#eaf6fb;border:1px solid #cc3300;cursor:pointer;">Pinottu
                    pylväs</button>
                <button id="alueentyopaikat-type-line" type="button"
                    style="font-size:15px;padding:4px 16px;border-radius:6px;background:#eaf6fb;border:1px solid #0077cc;cursor:pointer;">Viivakaavio</button>
                <button id="alueentyopaikat-toggle-datasets" type="button"
                    style="font-size:15px;padding:4px 16px;border-radius:6px;margin-left:8px;background:#f7fbfc;border:1px solid #666;cursor:pointer;">Piilota
                    kaikki kunnat</button>
            </div>
            <canvas id="alueentyopaikatChart" width="1100" height="600"></canvas>
            <div style="margin-top:8px; font-size:0.95em; color:#555;">Päivitetty: <span
                    id="alueentyopaikat-paivitys">-</span></div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            let alueentyopaikatChartObj = null;
            let alueentyopaikatCurrentType = 'bar';
            let alueentyopaikatAllHidden = false;
            let alueentyopaikatCurrentRegion = 'all';
            const alueentyopaikatPalette = ['#0077cc', '#cc3300', '#009933', '#3366cc', '#cc9900', '#9900cc', '#00cc99', '#ff6600', '#666666', '#1976d2', '#388e3c', '#fbc02d', '#d32f2f', '#7b1fa2', '#0288d1', '#c2185b', '#ffa000', '#689f38', '#f57c00', '#455a64', '#cddc39', '#e91e63', '#00bcd4', '#8bc34a', '#ff9800'];

            async function fetchAlueenTyopaikat(region = 'all') {
                try {
                    const url = region === 'all' ? 'alueentyopaikat_historia.php' : `alueentyopaikat_historia.php?maakunta_id=${region}`;
                    const res = await fetch(url);
                    const data = await res.json();
                    if (data.error) throw new Error(data.error);
                    return data;
                } catch (e) {
                    console.error('Virhe ladattaessa työpaikkadataa:', e);
                    return null;
                }
            }



            function renderAlueenTyopaikatChart(data, chartType = 'bar') {
                const ctx = document.getElementById('alueentyopaikatChart').getContext('2d');
                // Find if we have a comparison line dataset (last one, type: 'line')
                let comparisonLineIdx = -1;
                if (data.datasets.length > 0 && data.datasets[data.datasets.length - 1].type === 'line') {
                    comparisonLineIdx = data.datasets.length - 1;
                    // Remove color from comparison line
                    data.datasets[comparisonLineIdx].borderColor = '#444';
                    data.datasets[comparisonLineIdx].backgroundColor = 'rgba(0,0,0,0)';
                }
                data.datasets.forEach((ds, i) => {
                    if (i !== comparisonLineIdx) {
                        ds.backgroundColor = alueentyopaikatPalette[i % alueentyopaikatPalette.length] + (chartType === 'bar' ? 'cc' : '22');
                        ds.borderColor = alueentyopaikatPalette[i % alueentyopaikatPalette.length];
                    }
                    ds.stack = chartType === 'bar' && i !== comparisonLineIdx ? 'Stack 0' : undefined;
                    ds.borderWidth = i === comparisonLineIdx ? 3 : 1;
                    ds.fill = chartType === 'bar' && i !== comparisonLineIdx;
                    ds.pointRadius = i === comparisonLineIdx ? 3 : 2;
                    ds.tension = chartType === 'line' || i === comparisonLineIdx ? 0.15 : undefined;
                });
                if (alueentyopaikatChartObj) alueentyopaikatChartObj.destroy();
                alueentyopaikatChartObj = new Chart(ctx, {
                    type: chartType,
                    data: {
                        labels: data.labels,
                        datasets: data.datasets
                    },
                    options: {
                        responsive: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: {
                                mode: chartType === 'line' ? 'index' : 'nearest',
                                intersect: chartType !== 'line',
                                callbacks: {
                                    afterBody: function (context) {
                                        const yearIdx = context[0].dataIndex;
                                        // Sum selected region total (all bar datasets)
                                        let selectedTotal = 0;
                                        let comparisonTotal = null;
                                        context[0].chart.data.datasets.forEach((ds, i) => {
                                            if (ds.type === 'line') {
                                                comparisonTotal = ds.data[yearIdx];
                                            } else if (typeof ds.data[yearIdx] === 'number') {
                                                selectedTotal += ds.data[yearIdx];
                                            }
                                        });
                                        let lines = [];
                                        if (selectedTotal > 0) lines.push('Valittu alue yhteensä: ' + selectedTotal.toLocaleString('fi-FI'));
                                        if (comparisonTotal !== null && typeof comparisonTotal === 'number') lines.push('Vertailualue yhteensä: ' + comparisonTotal.toLocaleString('fi-FI'));
                                        return lines.join('\n');
                                    }
                                }
                            }
                        },
                        scales: {
                            x: { title: { display: true, text: 'Vuosi' }, stacked: chartType === 'bar' },
                            y: { title: { display: true, text: 'Työpaikat' }, stacked: chartType === 'bar' }
                        },
                        layout: { padding: 10 },
                        backgroundColor: '#f7fbfc'
                    }
                });
                // After chart redraw, update dataset visibility and button label
                if (alueentyopaikatAllHidden) {
                    alueentyopaikatChartObj.data.datasets.forEach(ds => { ds.hidden = true; });
                    alueentyopaikatChartObj.update();
                    document.getElementById('alueentyopaikat-toggle-datasets').textContent = 'Näytä kaikki kunnat';
                } else {
                    alueentyopaikatChartObj.data.datasets.forEach(ds => { ds.hidden = false; });
                    alueentyopaikatChartObj.update();
                    document.getElementById('alueentyopaikat-toggle-datasets').textContent = 'Piilota kaikki kunnat';
                }
            }


            async function updateAlueenTyopaikatChart(chartType = 'bar', region = 'all') {
                // For region 1 or 2, fetch both regions' data for overlay
                if (region === '1' || region === '2') {
                    const otherRegion = region === '1' ? '2' : '1';
                    const [mainData, otherData] = await Promise.all([
                        fetchAlueenTyopaikat(region),
                        fetchAlueenTyopaikat(otherRegion)
                    ]);
                    if (!mainData || !otherData) return;
                    // Sum other region's municipalities for each year
                    const yearCount = mainData.labels.length;
                    const otherTotals = Array(yearCount).fill(0);
                    otherData.datasets.forEach(ds => {
                        ds.data.forEach((val, idx) => {
                            otherTotals[idx] += typeof val === 'number' ? val : 0;
                        });
                    });
                    // Add as a line dataset
                    mainData.datasets.push({
                        label: otherRegion === '1' ? 'Päijät-Häme yhteensä (vertailu)' : 'Kanta-Häme yhteensä (vertailu)',
                        data: otherTotals,
                        type: 'line',
                        borderColor: '#222',
                        backgroundColor: 'rgba(0,0,0,0.08)',
                        borderWidth: 3,
                        pointRadius: 3,
                        fill: false,
                        tension: 0.15,
                        order: 99,
                        yAxisID: 'y',
                        datalabels: { display: false }
                    });
                    renderAlueenTyopaikatChart(mainData, chartType);
                    document.getElementById('alueentyopaikat-paivitys').textContent = mainData.latest_update || '-';
                    const statPaivitys2 = document.getElementById('stat-paivitys-2');
                    if (statPaivitys2) statPaivitys2.textContent = mainData.latest_update || '-';
                } else {
                    // Default: Koko Häme, no overlay
                    const data = await fetchAlueenTyopaikat(region);
                    if (!data) return;
                    renderAlueenTyopaikatChart(data, chartType);
                    document.getElementById('alueentyopaikat-paivitys').textContent = data.latest_update || '-';
                    const statPaivitys2 = document.getElementById('stat-paivitys-2');
                    if (statPaivitys2) statPaivitys2.textContent = data.latest_update || '-';
                }
            }

            document.addEventListener('DOMContentLoaded', function () {
                // Button controls
                const btnBar = document.getElementById('alueentyopaikat-type-bar');
                const btnLine = document.getElementById('alueentyopaikat-type-line');
                const btnToggle = document.getElementById('alueentyopaikat-toggle-datasets');
                const regionSelect = document.getElementById('alueentyopaikat-region-select');
                btnBar.style.fontWeight = 'bold';
                btnLine.style.fontWeight = 'normal';
                updateAlueenTyopaikatChart('bar', 'all');
                btnBar.addEventListener('click', function () {
                    alueentyopaikatCurrentType = 'bar';
                    btnBar.style.fontWeight = 'bold';
                    btnLine.style.fontWeight = 'normal';
                    updateAlueenTyopaikatChart('bar', alueentyopaikatCurrentRegion);
                });
                btnLine.addEventListener('click', function () {
                    alueentyopaikatCurrentType = 'line';
                    btnLine.style.fontWeight = 'bold';
                    btnBar.style.fontWeight = 'normal';
                    updateAlueenTyopaikatChart('line', alueentyopaikatCurrentRegion);
                });
                btnToggle.addEventListener('click', function () {
                    if (!alueentyopaikatChartObj) return;
                    alueentyopaikatAllHidden = !alueentyopaikatAllHidden;
                    alueentyopaikatChartObj.data.datasets.forEach(ds => { ds.hidden = alueentyopaikatAllHidden; });
                    alueentyopaikatChartObj.update();
                    btnToggle.textContent = alueentyopaikatAllHidden ? 'Näytä kaikki kunnat' : 'Piilota kaikki kunnat';
                });
                regionSelect.addEventListener('change', function () {
                    alueentyopaikatCurrentRegion = this.value;
                    updateAlueenTyopaikatChart(alueentyopaikatCurrentType, alueentyopaikatCurrentRegion);
                });
            });
        </script>
        <p align="center">Lähde: <a
                href="https://pxdata.stat.fi/PxWeb/pxweb/fi/StatFin/StatFin__tyokay/statfin_tyokay_pxt_115h.px/"
                target="_blank"
                title="115h -- Alueella työssäkäyvät (työpaikat) alueen, toimialan (TOL 2008), sukupuolen ja vuoden mukaan, 2007-2023">
                Tilastokeskus 115h</a> Alueella työssäkäyvät (työpaikat) , viimeisin tilasto tarkistettu lähteestä <b>
                <span id="stat-paivitys-2">...</span></b>


        <div class="textContainer"><br>
            <br><br><b><u> <a href="mediaseuranta.html" target="_blank" class='styled-link'>
                        <h2> Hämeen ELY-keskuksen
                            mediaseuranta</h2>
                    </a></u></b> Hämeen ELY-keskuksen mediaseuranta on koottu
            ajankohtaisista uutisista ja tiedotteista. Mediaseurannassa on mukana Hämeen alueen merkittävimmät uutiset
            elinvoimasta, työvoimasta ja osaamisesta. <br><br><br>
        </div>


        <br><br>
        <h2>Ostovoimaa, kulutushalua ja kasvua osoittavia indikaattoreita</h2><br><br>


        <!-- 
new embed charts here
 -->
        <div class="embedded-charts-flex" id="talous">
            <!-- Talous-indikaattorit Chart.js embedded chart with stat_code selector -->
            <div id="talous-indikaattorit-chart-container"
                style="max-width:600px;margin:0 auto 40px auto;background:#f7fbfc;padding:20px;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.10);">
                <h3 style="text-align:center;">Kuluttajien luottamus</h3>
                <div style="text-align:center;margin-bottom:12px;">
                    <span style="display:inline-block;">
                        <label><input type="radio" name="talous-statcode" value="SSS" checked> Koko maa</label>
                        <label style="margin-left:18px;"><input type="radio" name="talous-statcode" value="SA2_MK01XPK">
                            Etelä-Suomi</label>
                    </span>
                </div>
                <canvas id="talousIndikaattoritChart" width="560" height="340"></canvas>

            </div>


            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
                let talousChartInstance = null;
                function renderTalousChart(statCode) {
                    fetch('talous_historia.php?stat_code=' + encodeURIComponent(statCode))
                        .then(resp => resp.json())
                        .then(data => {
                            if (!data || !data.data || !data.data[statCode]) return;
                            const labels = data.data[statCode].labels.slice(-60);
                            const indicatorNames = [
                                { key: 'kuluttajienluottamus', label: 'Kuluttajien luottamus', color: '#0077cc' },
                                { key: 'omatalous', label: 'Oma talous', color: '#cc3300' },
                                { key: 'kuluttajahinnat', label: 'Kuluttajahinnat', color: '#009933' },
                                { key: 'tyottomyydenuhka', label: 'Työttömyyden uhka', color: '#cc9900' }
                            ];
                            const datasets = indicatorNames.map((ind, i) => {
                                return {
                                    label: ind.label,
                                    data: data.data[statCode][ind.key].slice(-60),
                                    borderColor: ind.color,
                                    backgroundColor: ind.color + '22',
                                    fill: true,
                                    tension: 0.3,
                                    pointRadius: 2,
                                    borderWidth: 2,
                                    type: 'line',
                                    order: i
                                };
                            });
                            const ctx = document.getElementById('talousIndikaattoritChart').getContext('2d');
                            if (talousChartInstance) talousChartInstance.destroy();
                            talousChartInstance = new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: labels,
                                    datasets: datasets
                                },
                                options: {
                                    responsive: false,
                                    plugins: {
                                        legend: { display: true, position: 'top' },
                                        tooltip: { mode: 'index', intersect: false }
                                    },
                                    scales: {
                                        x: { title: { display: true, text: 'Kuukausi' } },
                                        y: { title: { display: true, text: 'Indeksi' } }
                                    },
                                    layout: { padding: 10 },
                                    backgroundColor: '#f7fbfc'
                                }
                            });
                            // Show latest update
                            if (data.latest_update) {
                                document.getElementById('stat-paivitys').textContent = data.latest_update.split(' ')[0];
                            }
                        });
                }
                document.addEventListener('DOMContentLoaded', function () {
                    // Initial chart
                    renderTalousChart('SSS');
                    // Radio button event
                    document.querySelectorAll('input[name="talous-statcode"]').forEach(radio => {
                        radio.addEventListener('change', function () {
                            renderTalousChart(this.value);
                        });
                    });
                });
            </script>

            <!-- END Talous-indikaattorit Chart.js -->

            <!-- TKI (Tutkimus- ja kehittämistoiminta) Chart.js embedded chart -->
            <div id="tki-chart-container"
                style="max-width:600px;margin:0 auto 40px auto;background:#f7fbfc;padding:20px;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.10);">
                <h3 style="text-align:center;">Tutkimus- ja kehittämistoiminta</h3>
                <div
                    style="text-align:center;margin-bottom:12px;display:flex;justify-content:center;align-items:center;gap:20px;flex-wrap:wrap;">
                    <div>
                        <label for="tki-region-select"><b>Alue:</b></label>
                        <select id="tki-region-select"
                            style="font-size:14px;padding:4px 8px;border-radius:6px;width:140px;">
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    <div>
                        <label style="font-size:14px;"><input type="radio" name="tki-metric" value="tkmenot" checked>
                            T&K-menot</label>
                        <label style="font-size:14px;"><input type="radio" name="tki-metric" value="tkhenkilosto">
                            T&K-henkilöstö</label>
                        <label style="font-size:14px;"><input type="radio" name="tki-metric" value="tktyovuodet">
                            T&K-työvuodet</label>
                    </div>
                </div>
                <canvas id="tkiChart" width="560" height="340"></canvas>

            </div>

            <script>
                let tkiChartInstance = null;
                let tkiRegionsData = {}; // Store all regions data
                const tkiColors = ['#0077cc', '#cc3300', '#009933', '#cc9900', '#9900cc', '#00cc99', '#ff6600', '#666666', '#1976d2', '#388e3c', '#fbc02d', '#d32f2f', '#7b1fa2', '#0288d1', '#c2185b', '#ffa000'];

                async function fetchTkiData(region = 'SSS') {
                    try {
                        const url = region ? `tki_historia.php?stat_code=${region}` : 'tki_historia.php';
                        console.log('Fetching TKI data from:', url);
                        const response = await fetch(url);
                        const text = await response.text();
                        console.log('Raw response:', text);

                        const data = JSON.parse(text);
                        console.log('Parsed data:', data);

                        if (data.error) {
                            console.error('Server error:', data.error);
                            if (data.debug) console.log('Debug info:', data.debug);
                            throw new Error(data.error);
                        }

                        // Populate regions dropdown if we have regions data
                        if (data.regions && Object.keys(data.regions).length > 0) {
                            populateRegionsDropdown(data.regions);
                        }

                        return data;
                    } catch (error) {
                        console.error('Virhe TKI-datan haussa:', error);
                        // Show error to user
                        document.getElementById('tki-paivitys').textContent = 'Virhe: ' + error.message;
                        return null;
                    }
                }

                function populateRegionsDropdown(regions) {
                    const select = document.getElementById('tki-region-select');
                    const currentValue = select.value;

                    // Only populate if dropdown is empty
                    if (select.children.length === 0) {
                        // Add region options
                        Object.keys(regions).forEach(code => {
                            const option = document.createElement('option');
                            option.value = code;
                            option.textContent = regions[code];
                            select.appendChild(option);
                        });

                        // Set default to 'SSS' (Koko Suomi) if available
                        if (regions['SSS']) {
                            select.value = 'SSS';
                        } else if (Object.keys(regions).length > 0) {
                            select.value = Object.keys(regions)[0];
                        }
                    }
                }

                function renderTkiChart(data, metric) {
                    if (!data) {
                        console.log('No data received');
                        return;
                    }

                    if (!data.data) {
                        console.log('No data.data property:', data);
                        return;
                    }

                    if (!data.data[metric]) {
                        console.log(`No data for metric '${metric}'. Available metrics:`, Object.keys(data.data));
                        return;
                    }

                    const ctx = document.getElementById('tkiChart').getContext('2d');
                    const datasets = data.data[metric].map((dataset, index) => ({
                        label: dataset.label,
                        data: dataset.data,
                        borderColor: tkiColors[index % tkiColors.length],
                        backgroundColor: tkiColors[index % tkiColors.length] + '22',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 3,
                        borderWidth: 2
                    }));

                    if (tkiChartInstance) tkiChartInstance.destroy();

                    tkiChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.labels,
                            datasets: datasets
                        },
                        options: {
                            responsive: false,
                            plugins: {
                                legend: { display: true, position: 'top' },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        label: function (context) {
                                            let unit = '';
                                            if (metric === 'tkmenot') unit = ' milj.EUR';
                                            else if (metric === 'tkhenkilosto') unit = ' hlöä';
                                            else if (metric === 'tktyovuodet') unit = ' htv';
                                            return context.dataset.label + ': ' + context.parsed.y + unit;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: { title: { display: true, text: 'Vuosi' } },
                                y: {
                                    title: {
                                        display: true,
                                        text: metric === 'tkmenot' ? 'Milj. EUR' :
                                            metric === 'tkhenkilosto' ? 'Henkilöstö (lkm)' :
                                                'Työvuodet (htv)'
                                    }
                                }
                            },
                            layout: { padding: 10 },
                            backgroundColor: '#f7fbfc'
                        }
                    });

                    // Update timestamp
                    if (data.latest_update) {
                        document.getElementById('tki-paivitys').textContent = data.latest_update.split(' ')[0];
                    }
                    if (data.timestamp) {
                        document.getElementById('tki-timestamp').textContent = data.timestamp;
                    }
                }

                async function updateTkiChart() {
                    const selectedMetric = document.querySelector('input[name="tki-metric"]:checked').value;
                    const selectedRegion = document.getElementById('tki-region-select').value || 'SSS';

                    // Pass the selected region as is - let backend handle SSS specifically
                    const data = await fetchTkiData(selectedRegion);

                    if (data) {
                        renderTkiChart(data, selectedMetric);
                    }
                }

                document.addEventListener('DOMContentLoaded', async function () {
                    // First fetch all regions data to populate dropdown
                    const allRegionsData = await fetchTkiData('');
                    
                    // Then load SSS data for initial chart display
                    updateTkiChart();

                    // Event listeners for radio buttons
                    document.querySelectorAll('input[name="tki-metric"]').forEach(radio => {
                        radio.addEventListener('change', updateTkiChart);
                    });

                    // Event listener for region dropdown
                    document.getElementById('tki-region-select').addEventListener('change', updateTkiChart);
                });
            </script>
            <!-- END TKI Chart.js -->


        </div>
        <p align="center">Lähde: <a
                href="https://pxdata.stat.fi/PxWeb/pxweb/fi/StatFin/StatFin__kbar/statfin_kbar_pxt_11vs.px/"
                target="_blank" title="11vs -- Kuluttajien luottamus alueittain, 2019M05-2025M09">
                Tilastokeskus 11vs</a> Kuluttajien luottamus alueittain, viimeisin tilasto tarkistettu lähteestä <b>
                <span id="stat-paivitys">...</span></b></p>
        <p align="center">Lähde: <a
                href="https://pxdata.stat.fi/PxWeb/pxweb/fi/StatFin/StatFin__tkke/statfin_tkke_pxt_13tn.px/"
                target="_blank"
                title="13tn -- Tutkimus- ja kehittämistoiminnan menot, henkilöstö ja työvuodet alueittain, 2011-2024">
                Tilastokeskus 13tn</a> viimeisin tilasto julkaistu:<b> <span
                    id="tki-paivitys">...</span></b> , tarkistettu lähteestä: <b><span id="tki-timestamp">...</span></b></p>

           <!--  </div> -->

        <!--         <div class="centerContainer">
            <iframe src='https://flo.uri.sh/visualisation/21822888/embed' title='Interactive or visual content'
                class='flourish-embed-iframe' frameborder='0' scrolling='no' style='width:40%;height:400px;'
                sandbox='allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation'></iframe>
            <iframe src='https://flo.uri.sh/visualisation/21825714/embed' title='Interactive or visual content'
                class='flourish-embed-iframe' frameborder='0' scrolling='no' style='width:40%;height:400px;'
                sandbox='allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation'></iframe>

        </div> -->


        <div class="centerContainer">
            <iframe src='https://flo.uri.sh/visualisation/21386615/embed' title='Interactive or visual content'
                class='flourish-embed-iframe' frameborder='0' scrolling='no' style='width:40%;height:400px;'
                sandbox='allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation'></iframe>

            <iframe src='https://flo.uri.sh/visualisation/21825714/embed' title='Interactive or visual content'
                class='flourish-embed-iframe' frameborder='0' scrolling='no' style='width:40%;height:370px;'
                sandbox='allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation'></iframe>


            <!--            <iframe src='https://flo.uri.sh/visualisation/21384722/embed' title='Interactive or visual content'
                class='flourish-embed-iframe' frameborder='0' scrolling='no' style='width:40%;height:400px;'
                sandbox='allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation'></iframe>
 -->
        </div>
        <br><br><br>
        <h2>Aloittaneita ja lopettaneita yrityksiä kuvaavia lukuja</h2>
        <div class="textContainer">
            <br><br><b> Aloittaneet ja lopettaneet yritykset.</b> <br> Huomioitavaa on että aloittaneita yrityksiä on
            noin kolmannes enemmän kuin lopettaneita yrityksiä. -Sama ilmiö toistuu koko maan-, sekä Hämeen alueella.
            <br>*Lähde: tilastokeskus
        </div>



        <div class="centerContainer">
            <iframe title="Stat_aloittaneet_ja_lopettaneet mittarit" width="80%" height="450"
                src="https://app.powerbi.com/view?r=eyJrIjoiZWU4ZGNlM2YtMmIwZS00NDMxLTkyNGYtNmUyZDYxMmYwYzEzIiwidCI6ImM3YjJjZGYxLTcxN2YtNGY3Mi04NGUwLWY2Nzg0Nzk5YTgzNiIsImMiOjh9"
                frameborder="0" allowFullScreen="true"></iframe>

        </div>

        <div class="textContainer">
            <br><br>
            <h2> Tarkempi katsaus aloittaneisiin ja lopettaneisiin yrityksiin.</h2>
            *Lähde: tilastokeskus
        </div>
        <div class="centerContainer">
            <iframe title="Profinder-data" width="100%" height="720"
                src="https://app.powerbi.com/view?r=eyJrIjoiM2MxYTA2MzUtZWI3OS00YzU0LTg2YjUtYTQ4NmEzOWFiOWQ5IiwidCI6ImM3YjJjZGYxLTcxN2YtNGY3Mi04NGUwLWY2Nzg0Nzk5YTgzNiIsImMiOjh9"
                frameborder="0" allowFullScreen="true"></iframe>
        </div><br><br>


        <div class="centerContainer">
            <h2>Toimialaerittely aloittaneista/lopettaneista yrityksistä. </h2>
            </p>
            <br>
            <iframe title="Stat_aloittaneet_ja_lopettaneet" width="100%" height="720"
                src="https://app.powerbi.com/view?r=eyJrIjoiMGJmMWM4ZTgtODA0Yy00NzZkLTlkZjYtYWU4ZTQwOWI4NjAxIiwidCI6ImM3YjJjZGYxLTcxN2YtNGY3Mi04NGUwLWY2Nzg0Nzk5YTgzNiIsImMiOjh9"
                frameborder="0" allowFullScreen="true"></iframe>
        </div><br><br>


        <div class="textContainer">
            <br><br><b>
                <h2> Kanta-Hämeen Elinvoimakatsaus.</h2>
            </b> <br> Hämeen liiton elinvoimakatsauksessa on ajankohtaiset tiedot
            mm. elinkeinon tilanteesta. <a
                href="https://app.powerbi.com/view?r=eyJrIjoiODFkNGVlMDAtMzMxZi00MWI0LWE3YTEtMzM0ZGQzMzliOGNjIiwidCI6ImI0MjZhNDVlLTBiMjYtNGE0MC05MWUxLTVhYjdlODc4OThlYyIsImMiOjh9"
                target="_blank">Avaa
                uuteen ikkunaan</a>
            *Copyright: <a
                href="https://hameenliitto.fi/ennakointi-ja-tietopalvelut/tilastot-ja-tietografiikka/kanta-hameen-elinvoimakatsaus/"
                target="_blank">
                Hämeen liitto </a><br><br>
        </div>
        <div class="centerContainer">
            <iframe title="Hämeen Elinvoimakatsaus" width="100%" height="720" src="https://app.powerbi.com/view?r=eyJrIjoiODFkNGVlMDAtMzMxZi00MWI0LWE3YTEtMzM0ZGQzMzliOGNjIiwidCI6ImI0MjZhNDVlLTBiMjYtNGE0MC05MWUxLTVhYjdlODc4OThlYyIsImMiOjh9
                " frameborder="0" allowFullScreen="true"></iframe>
        </div><br><br>


    </div>
    <!-- Footer ja lisätiedot -->
    <div class="footer">
        <div class="w-container">
            <div class="w-row">
                <div class="spc w-col w-col-4">
                    <h5>Sivuston osiot</h5>
                    <a href="opiskelu.html" class="footer-link">Tilannekuva</a>
                    <a href="ennakointi.html" class="footer-link">Tulevaisuuskuva</a>
                    <a href="info.html" class="footer-link">Tietoa meistä</a>
                    <a href="mailto:info@tulevaisuusluotain.fi;christian@tulevaisuusluotain.fi?subject=Palautetta tulevaisuusluotain-sivuston kautta"" class="
                        footer-link"><b>ANNA PALAUTETTA TAI KEHITYSEHDOTUKSIA</b></a>
                    <a href="mediaseuranta.html" class="footer-link" target="_blank"><b>HÄMEEN ELY-MEDIASEURANTA</b></a>
                    <a href="Saavutettavuusseloste.html" class="footer-link"
                        target="_blank"><b>SAAVUTETTAVUUSSELOSTE</b></a>
                </div>
                <div class="spc w-col w-col-4">
                    <h5>Tilannekuva - osio</h5>
                    <a href="opiskelu.html" class="footer-link">Koulutus</a>
                    <a href="tyollisyys.html" class="footer-link">Työllisyys</a>
                    <a href="vaesto.html" class="footer-link">Väestö</a>
                    <a href="aluekehitys.html" class="footer-link">Elinvoima</a>

                </div>

                <div class=" w-col w-col-4">
                    <h5>Hyödyllisiä linkkejä</h5>
                    <a href="https://www.osaamistarvekompassi.fi" class="footer-link" target="_blank">JOTPA -
                        Osaamistarvekompassi</a>
                    <a href="https://www.oph.fi/fi/palvelut/osaamisen-ennakointifoorumi-oef" target="_blank"
                        class="footer-link">OEF - Osaamisen ennakointifoorumi</a>
                    <a href="https://tyomarkkinatori.fi/teemasivut/tyovoiman-saatavuus-ja-kohtaanto" target="_blank"
                        class="footer-link">Työvoiman saatavuus ja kohtaanto</a>
                    <a href="https://vipunen.fi/fi-fi/ennakointi" class="footer-link" target="_blank">Vipunen /
                        Ennakointi</a>
                    <a href="https://app.powerbi.com/view?r=eyJrIjoiODFkNGVlMDAtMzMxZi00MWI0LWE3YTEtMzM0ZGQzMzliOGNjIiwidCI6ImI0MjZhNDVlLTBiMjYtNGE0MC05MWUxLTVhYjdlODc4OThlYyIsImMiOjh9"
                        class="footer-link" target="_blank"">
                        Hämeen elinvoimakatsaus</a>
                </div>
            </div>
        </div>
    </div>

        <div class=" footer center">
                </div>
                <script
                    src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=663b57613daa22b24eb91975"
                    type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
                    crossorigin="anonymous"></script>
                <script src="webflow.js" type="text/javascript"></script>
                <script type="text/javascript">
                    // Ladataan tuo otsikot.html tiedostosta, kun sitä samaa käytetään niin monessa paikassa
                    function otsikot() {
                        fetch('./otsikot.html')
                            .then(response => response.text())
                            .then(data => {
                                const placeholder = document.getElementById('otsikot-placeholder');
                                placeholder.innerHTML = data;
                            })
                            .catch(error => console.error('Error loading otsikot.html:', error));
                    }
                    otsikot();
                </script>
</body>

</html>